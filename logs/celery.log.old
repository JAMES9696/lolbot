The currently activated Python version 3.11.13 is not supported by the project (~3.12).
Trying to find and use a compatible version.
Using python3.12 (3.12.11)

 -------------- celery@KindeMac-mini.local v5.5.3 (immunity)
--- ***** -----
-- ******* ---- macOS-26.1-arm64-arm-64bit 2025-10-07 15:16:51
- *** --- * ---
- ** ---------- [config]
- ** ---------- .> app:         project_chimera:0x10723e360
- ** ---------- .> transport:   redis://:**@localhost:6379/0
- ** ---------- .> results:     redis://:**@localhost:6379/1
- *** --- * --- .> concurrency: 4 (prefork)
-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)
--- ***** -----
 -------------- [queues]
                .> ai               exchange=ai(direct) key=ai
                .> celery           exchange=celery(direct) key=celery
                .> matches          exchange=matches(direct) key=matches

[tasks]
  . src.tasks.analysis_tasks.analyze_match_task
  . src.tasks.match_tasks.batch_fetch_matches
  . src.tasks.match_tasks.fetch_and_store_match
  . src.tasks.match_tasks.fetch_match_history
  . src.tasks.team_tasks.analyze_team_task

[2025-10-07 15:16:52,080: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-07 15:16:52,089: INFO/MainProcess] mingle: searching for neighbors
[2025-10-07 15:16:53,102: INFO/MainProcess] mingle: all alone
[2025-10-07 15:16:53,119: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-07 15:17:04,315: INFO/MainProcess] Task src.tasks.analysis_tasks.analyze_match_task[0032a809-8b16-4097-8189-8e5fe03ca0c3] received
[2025-10-07 15:17:04,332: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks.analyze_match_task_1759875424330772", "args": ["<@task: src.tasks.analysis_tasks.analyze_match_task of project_chimera at 0x10723e360>"], "kwargs": {"application_id": "1424636668098642011", "interaction_token": "aW50ZXJhY3Rpb246MTQyNTI0NTU1OTQ5NjkwMDYzODpJdEpIUmhMSmhiS3Y5a25UY0Y3b3FTamR0aldyaTZQVUdKNkZsazNEdDdjMzVTRUxZbEZQalZQUlBlRVhjZGpLdWxiR0xGUTJkSnJiZTl6R0thd0NKNDVMYm04RmJtbUxrNWJJTFcwb05ldHlsdFJlSHN1eVl6QW5BRE0yRWNHeA", "channel_id": "1424680991313625108", "discord_user_id": "455184236446613526", "puuid": "mBDJvWyyCm8TBOsl3ZIg6ueLcr1I9alzpYolbt_rmp2Uvtn8RvpeMw9MKD_6EFzWTZx-wADQ4QZLUQ", "match_id": "NA1_5388050490", "region": "na1", "match_index": 1}, "event": "Executing function: src.tasks.analysis_tasks.analyze_match_task", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:04.332697Z", "filename": "observability.py", "func_name": "sync_wrapper", "lineno": 298}
[2025-10-07 15:17:04,340: INFO/ForkPoolWorker-2] Beginning construction of type graph
[2025-10-07 15:17:04,340: INFO/ForkPoolWorker-2] Added source "<cassiopeia.datastores.lolwikia.LolWikia object at 0x10d723c20>" to type graph
[2025-10-07 15:17:04,341: INFO/ForkPoolWorker-2] Added source "<cassiopeia.datastores.cache.Cache object at 0x10d723080>" to type graph
[2025-10-07 15:17:04,341: INFO/ForkPoolWorker-2] Added source "<cassiopeia.datastores.riotapi.RiotAPI object at 0x10d488290>" to type graph
[2025-10-07 15:17:04,341: INFO/ForkPoolWorker-2] Added source "<cassiopeia.datastores.merakianalyticscdn.MerakiAnalyticsCDN object at 0x10d599910>" to type graph
[2025-10-07 15:17:04,341: INFO/ForkPoolWorker-2] Added source "<cassiopeia.datastores.ddragon.DDragon object at 0x10d723350>" to type graph
[2025-10-07 15:17:04,342: INFO/ForkPoolWorker-2] Added source "<cassiopeia.datastores.ghost.UnloadedGhostStore object at 0x10d723bc0>" to type graph
[2025-10-07 15:17:04,342: INFO/ForkPoolWorker-2] Added sink "<cassiopeia.datastores.cache.Cache object at 0x10d723080>" to type graph
[2025-10-07 15:17:04,342: INFO/ForkPoolWorker-2] Added transformer "<datapipelines.transformers.CompositeDataTransformer object at 0x10c7a1a00>" to type graph
[2025-10-07 15:17:04,342: INFO/ForkPoolWorker-2] Completed construction of type graph
[2025-10-07 15:17:04,343: INFO/ForkPoolWorker-2] Riot API adapter initialized with Cassiopeia
[2025-10-07 15:17:04,344: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._fetch_timeline_with_observability_1759875424344165", "args": ["<src.adapters.riot_api.RiotAPIAdapter object at 0x10d723260>", "NA1_5388050490", "na1"], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._fetch_timeline_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:04.344275Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 213}
[2025-10-07 15:17:06,923: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._fetch_timeline_with_observability_1759875424344165", "duration_ms": 2578.132333001122, "result": null, "event": "Successfully executed: src.tasks.analysis_tasks._fetch_timeline_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:06.923109Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 235}
[2025-10-07 15:17:07,894: INFO/ForkPoolWorker-2] Database adapter initialized
[2025-10-07 15:17:08,053: INFO/ForkPoolWorker-2] Database connection pool created successfully
[2025-10-07 15:17:08,061: INFO/ForkPoolWorker-2] Database schema initialized
[2025-10-07 15:17:08,121: INFO/ForkPoolWorker-2] Saved match data for NA1_5388050490
[2025-10-07 15:17:08,122: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._save_analysis_with_observability_1759875428122660", "args": ["<src.adapters.database.DatabaseAdapter object at 0x10d7447a0>", "NA1_5388050490", "mBDJvWyyCm8TBOsl3ZIg6ueLcr1I9alzpYolbt_rmp2Uvtn8RvpeMw9MKD_6EFzWTZx-wADQ4QZLUQ", "{\"match_id\": \"NA1_5388050490\", \"game_duration_minutes\": 32.5847, \"player_scores\": [{\"participant_id\": 7, \"total_score\": 71.09706461266765, \"combat_efficiency\": 61.904761904761905, \"economic_management\": 84.33526324727045, \"objective_control\": 100.0, \"vision_control\": 49.60338747939984, \"team_contribution\": 14.814814814814813, \"kda\": 2.5714285714285716, \"cs_per_min\": 5.769578974181134, \"gold_difference\": 4531.0, \"kill_participation\": 60.0, \"strengths\": [\"Objective Control\", \"Economic Management\"], \"improvements\": [\"Vision Control\", \"Team Contribution\"], \"emotion_tag\": \"positive\"}, {\"participant_id\": 1, \"total_score\": 59.53627728189513, \"combat_efficiency\": 63.33333333333333, \"economic_management\": 92.53107403986124, \"objective_control\": 28.947368421052634, \"vision_control\": 55.00000000000001, \"team_contribution\": 46.666666666666664, \"kda\": 4.0, \"cs_per_min\": 8.500922211958374, \"gold_difference\": 4258.4, \"kill_participation\": 50.0, \"strengths\": [\"Economic Management\", \"Combat Efficiency\"...", "na1", 15.124874975299463], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._save_analysis_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:08.122820Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 213}
[2025-10-07 15:17:08,124: INFO/ForkPoolWorker-2] Saved analysis result for match NA1_5388050490
[2025-10-07 15:17:08,125: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._save_analysis_with_observability_1759875428122660", "duration_ms": 2.029458002652973, "result": true, "event": "Successfully executed: src.tasks.analysis_tasks._save_analysis_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:08.125116Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 235}
[2025-10-07 15:17:08,129: INFO/ForkPoolWorker-2] Database connection pool closed
[2025-10-07 15:17:08,272: INFO/ForkPoolWorker-2] Database connection pool created successfully
[2025-10-07 15:17:08,277: INFO/ForkPoolWorker-2] Database schema initialized
[2025-10-07 15:17:08,280: INFO/ForkPoolWorker-2] Updated analysis status for NA1_5388050490: analyzing
[2025-10-07 15:17:08,284: INFO/ForkPoolWorker-2] Database connection pool closed
[2025-10-07 15:17:08,285: INFO/ForkPoolWorker-2] Redis client connected
[2025-10-07 15:17:08,285: INFO/ForkPoolWorker-2] GeminiLLMAdapter initialized with model=gemini-2.5-flash, temperature=0.7, JSON mode enabled
[2025-10-07 15:17:08,286: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._generate_narrative_with_cache_1759875428286061", "args": ["<src.adapters.gemini_llm.GeminiLLMAdapter object at 0x10d6553d0>", "<src.adapters.redis_adapter.RedisAdapter object at 0x10d598530>", "{\"match_id\": \"NA1_5388050490\", \"game_duration_minutes\": 32.5847, \"player_scores\": [{\"participant_id\": 7, \"total_score\": 71.09706461266765, \"combat_efficiency\": 61.904761904761905, \"economic_management\": 84.33526324727045, \"objective_control\": 100.0, \"vision_control\": 49.60338747939984, \"team_contribution\": 14.814814814814813, \"kda\": 2.5714285714285716, \"cs_per_min\": 5.769578974181134, \"gold_difference\": 4531.0, \"kill_participation\": 60.0, \"strengths\": [\"Objective Control\", \"Economic Management\"], \"improvements\": [\"Vision Control\", \"Team Contribution\"], \"emotion_tag\": \"positive\"}, {\"participant_id\": 1, \"total_score\": 59.53627728189513, \"combat_efficiency\": 63.33333333333333, \"economic_management\": 92.53107403986124, \"objective_control\": 28.947368421052634, \"vision_control\": 55.00000000000001, \"team_contribution\": 46.666666666666664, \"kda\": 4.0, \"cs_per_min\": 8.500922211958374, \"gold_difference\": 4258.4, \"kill_participation\": 50.0, \"strengths\": [\"Economic Management\", \"Combat Efficiency\"...", "\"You are an expert League of Legends analyst and coach assistant. Your role is to provide insightful, actionable match analysis based on structured performance data.\\n\\n## Your Persona\\n\\n- **Professional Analyst**: You analyze data objectively, focusing on facts and patterns\\n- **Constructive Coach**: You highlight both strengths and improvement areas\\n- **Engaging Storyteller**: You make data interesting through narrative flow\\n- **Improvement-Focused**: You prioritize actionable insights over criticism\\n\\n## Analysis Guidelines\\n\\n### Tone & Style\\n- Use second person (\\\"you\\\") when addressing the player directly\\n- Balance praise for strong performance with constructive feedback\\n- Avoid harsh criticism; frame weaknesses as \\\"growth opportunities\\\"\\n- Adapt emotional tone based on match outcome:\\n  - **Victory + Strong Performance**: Enthusiastic, celebratory\\n  - **Victory + Weak Performance**: Encouraging but honest\\n  - **Defeat + Strong Performance**: Sympathetic, morale-boosti..."], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._generate_narrative_with_cache", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:08.286188Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 213}
[2025-10-07 15:17:08,288: INFO/ForkPoolWorker-2] Generating narrative for match NA1_5388050490
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1759875428.332509 6012109 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
[2025-10-07 15:17:09,998: ERROR/ForkPoolWorker-2] Gemini API error for match NA1_5388050490: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.
[2025-10-07 15:17:10,005: ERROR/ForkPoolWorker-2] {"function_name": "src.tasks.analysis_tasks._generate_narrative_with_cache", "execution_id": "src.tasks.analysis_tasks._generate_narrative_with_cache_1759875428286061", "duration_ms": 1712.2691250115167, "error_type": "GeminiAPIError", "error_message": "Gemini API error: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.", "traceback": "Traceback (most recent call last):\n  File \"/Users/kim/Downloads/lolbot/src/adapters/gemini_llm.py\", line 170, in analyze_match\n    response = await asyncio.to_thread(self.model.generate_content, prompt)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/threads.py\", line 25, in to_thread\n    return await loop.run_in_executor(None, func_call)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/generativeai/generative_models.py\", line 248, in generate_content\n    response = self._client.generate_content(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py\", line 566, in generate_content\n    response = rpc(\n               ^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py\", line 131, in __call__\n    return wrapped_func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py\", line 294, in retry_wrapped_func\n    return retry_target(\n           ^^^^^^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py\", line 156, in retry_target\n    next_sleep = _retry_error_helper(\n                 ^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/retry/retry_base.py\", line 214, in _retry_error_helper\n    raise final_exc from source_exc\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py\", line 147, in retry_target\n    result = target()\n             ^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/timeout.py\", line 130, in func_with_timeout\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/google/api_core/grpc_helpers.py\", line 77, in error_remapped_callable\n    raise exceptions.from_grpc_error(exc) from exc\ngoogle.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/kim/Downloads/lolbot/src/core/observability.py\", line 224, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Downloads/lolbot/src/tasks/analysis_tasks.py\", line 763, in _generate_narrative_with_cache\n    narrative = await llm_adapter.analyze_match(match_data, system_prompt)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kim/Downloads/lolbot/src/adapters/gemini_llm.py\", line 223, in analyze_match\n    raise GeminiAPIError(f\"Gemini API error: {e}\") from e\nsrc.adapters.gemini_llm.GeminiAPIError: Gemini API error: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.\n", "args": ["<src.adapters.gemini_llm.GeminiLLMAdapter object at 0x10d6553d0>", "<src.adapters.redis_adapter.RedisAdapter object at 0x10d598530>", "{\"match_id\": \"NA1_5388050490\", \"game_duration_minutes\": 32.5847, \"player_scores\": [{\"participant_id\": 7, \"total_score\": 71.09706461266765, \"combat_efficiency\": 61.904761904761905, \"economic_management\": 84.33526324727045, \"objective_control\": 100.0, \"vision_control\": 49.60338747939984, \"team_contribution\": 14.814814814814813, \"kda\": 2.5714285714285716, \"cs_per_min\": 5.769578974181134, \"gold_difference\": 4531.0, \"kill_participation\": 60.0, \"strengths\": [\"Objective Control\", \"Economic Management\"], \"improvements\": [\"Vision Control\", \"Team Contribution\"], \"emotion_tag\": \"positive\"}, {\"participant_id\": 1, \"total_score\": 59.53627728189513, \"combat_efficiency\": 63.33333333333333, \"economic_management\": 92.53107403986124, \"objective_control\": 28.947368421052634, \"vision_control\": 55.00000000000001, \"team_contribution\": 46.666666666666664, \"kda\": 4.0, \"cs_per_min\": 8.500922211958374, \"gold_difference\": 4258.4, \"kill_participation\": 50.0, \"strengths\": [\"Economic Management\", \"Combat Efficiency\"...", "\"You are an expert League of Legends analyst and coach assistant. Your role is to provide insightful, actionable match analysis based on structured performance data.\\n\\n## Your Persona\\n\\n- **Professional Analyst**: You analyze data objectively, focusing on facts and patterns\\n- **Constructive Coach**: You highlight both strengths and improvement areas\\n- **Engaging Storyteller**: You make data interesting through narrative flow\\n- **Improvement-Focused**: You prioritize actionable insights over criticism\\n\\n## Analysis Guidelines\\n\\n### Tone & Style\\n- Use second person (\\\"you\\\") when addressing the player directly\\n- Balance praise for strong performance with constructive feedback\\n- Avoid harsh criticism; frame weaknesses as \\\"growth opportunities\\\"\\n- Adapt emotional tone based on match outcome:\\n  - **Victory + Strong Performance**: Enthusiastic, celebratory\\n  - **Victory + Weak Performance**: Encouraging but honest\\n  - **Defeat + Strong Performance**: Sympathetic, morale-boosti..."], "kwargs": {}, "event": "Error in function", "logger": "src.core.observability", "level": "error", "timestamp": "2025-10-07T22:17:10.005087Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 253}
[2025-10-07 15:17:10,005: WARNING/ForkPoolWorker-2] LLM failed; using fallback narrative: Gemini API error: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits.
[2025-10-07 15:17:10,157: INFO/ForkPoolWorker-2] Database connection pool created successfully
[2025-10-07 15:17:10,162: INFO/ForkPoolWorker-2] Database schema initialized
[2025-10-07 15:17:10,168: INFO/ForkPoolWorker-2] Updated LLM narrative for match NA1_5388050490
[2025-10-07 15:17:10,176: INFO/ForkPoolWorker-2] Database connection pool closed
[2025-10-07 15:17:11,091: INFO/ForkPoolWorker-2] Discord webhook adapter initialized
[2025-10-07 15:17:11,092: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._send_final_report_webhook_1759875431092405", "args": ["<src.adapters.discord_webhook.DiscordWebhookAdapter object at 0x10c7f15e0>", "1424636668098642011", "aW50ZXJhY3Rpb246MTQyNTI0NTU1OTQ5NjkwMDYzODpJdEpIUmhMSmhiS3Y5a25UY0Y3b3FTamR0aldyaTZQVUdKNkZsazNEdDdjMzVTRUxZbEZQalZQUlBlRVhjZGpLdWxiR0xGUTJkSnJiZTl6R0thd0NKNDVMYm04RmJtbUxrNWJJTFcwb05ldHlsdFJlSHN1eVl6QW5BRE0yRWNHeA", {"match_id": "NA1_5388050490", "match_result": "defeat", "summoner_name": "", "champion_name": "Ryze", "champion_id": 13, "ai_narrative_text": "[\u964d\u7ea7\u6a21\u5f0f] Match NA1_5388050490 | \u7528\u65f6 32.6 \u5206\u949f\n\u603b\u4f53\u7ed3\u8bba\uff1a\u53d1\u6325\u7a33\u5b9a\uff08\u7efc\u5408 71.1 \u5206\uff09\n\u5ba2\u89c2\u4e8b\u5b9e\uff1a\n- KDA 2.57\uff0c\u53c2\u56e2\u7387 60% \uff0c\u5206\u5747\u8865\u5200 5.8\n- \u7269\u4ef6\u63a7\u5236 100.0\uff0c\u56e2\u961f\u534f\u540c 14.8\uff0c\u89c6\u91ce 49.6\n- \u4f18\u52bf\u70b9\uff1aObjective Control\u3001Economic Management\uff1b\u6539\u8fdb\u70b9\uff1aVision Control\u3001Team Contribution\n\u6267\u884c\u5efa\u8bae\uff1a\u4f18\u5148\u8865\u5f3a\u300e\u56e2\u961f\u534f\u540c\u300f\u7ef4\u5ea6\uff0c\u7ed3\u5408\u9635\u5bb9\u8282\u594f\u505a\u4e00\u6b21\u5c0f\u76ee\u6807\uff08\u5148\u950b/\u4e00\u5854/\u6cb3\u9053\u89c6\u91ce\uff09\u6765\u8f6c\u5316\u4f18\u52bf\u3002", "llm_sentiment_tag": "\u5e73\u6de1", "v1_score_summary": {"combat_score": 60.317460317460316, "economy_score": 78.9727157019501, "vision_score": 26.13784997253312, "objective_score": 0.0, "teamplay_score": 62.745098039215684, "overall_score": 46.726711821900494}, "champion_assets_url": "https://ddragon.leagueoflegends.com/cdn/14.20.1/img/champion/Ryze.png", "processing_duration_ms": 6757.141459005652, "algorithm_version": "v1", "tts_audio_url": null}], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._send_final_report_webhook", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:11.092715Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 213}
[2025-10-07 15:17:11,145: INFO/ForkPoolWorker-2] Rendered analysis embed for  (defeat) - Overall Score: 46.7
[2025-10-07 15:17:12,382: INFO/ForkPoolWorker-2] Successfully published analysis for match NA1_5388050490 via webhook (token: aW50ZXJhY3...)
[2025-10-07 15:17:12,382: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks._send_final_report_webhook_1759875431092405", "duration_ms": 1289.7754590085242, "result": true, "event": "Successfully executed: src.tasks.analysis_tasks._send_final_report_webhook", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:12.382757Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 235}
[2025-10-07 15:17:12,539: INFO/ForkPoolWorker-2] Database connection pool created successfully
[2025-10-07 15:17:12,546: INFO/ForkPoolWorker-2] Database schema initialized
[2025-10-07 15:17:12,552: INFO/ForkPoolWorker-2] Updated analysis status for NA1_5388050490: completed
[2025-10-07 15:17:12,558: INFO/ForkPoolWorker-2] Database connection pool closed
[2025-10-07 15:17:12,560: INFO/ForkPoolWorker-2] {"execution_id": "src.tasks.analysis_tasks.analyze_match_task_1759875424330772", "duration_ms": 8226.542874996085, "result": {"success": true, "match_id": "NA1_5388050490", "score_data_saved": true, "timeline_cached": false, "webhook_delivered": true, "fetch_duration_ms": 2590.867040999001, "scoring_duration_ms": 15.124874975299463, "save_duration_ms": 1190.5408329912461, "llm_duration_ms": 2046.2058749981225, "tts_duration_ms": null, "webhook_duration_ms": 2206.706208991818, "total_duration_ms": 8225.240917003248, "error_message": null, "error_stage": null}, "event": "Successfully executed: src.tasks.analysis_tasks.analyze_match_task", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:17:12.560327Z", "filename": "observability.py", "func_name": "sync_wrapper", "lineno": 320}
[2025-10-07 15:17:12,562: INFO/ForkPoolWorker-2] Task src.tasks.analysis_tasks.analyze_match_task[0032a809-8b16-4097-8189-8e5fe03ca0c3] succeeded in 8.239903500012588s: {'success': True, 'match_id': 'NA1_5388050490', 'score_data_saved': True, 'timeline_cached': False, 'webhook_delivered': True, 'fetch_duration_ms': 2590.867040999001, 'scoring_duration_ms': 15.124874975299463, 'save_duration_ms': 1190.5408329912461, 'llm_duration_ms': 2046.2058749981225, 'tts_duration_ms': None, 'webhook_duration_ms': 2206.706208991818, 'total_duration_ms': 8225.240917003248, 'error_message': None, 'error_stage': None}

worker: Warm shutdown (MainProcess)
[2025-10-07 15:55:39,797: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-07 15:55:39,801: INFO/MainProcess] mingle: searching for neighbors
[2025-10-07 15:55:40,812: INFO/MainProcess] mingle: all alone
[2025-10-07 15:55:40,833: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-07 15:58:45,361: INFO/MainProcess] Task src.tasks.team_tasks.analyze_team_task[8820d66a-1494-43ff-a45c-9bc9dfafafd1] received
[2025-10-07 15:58:45,389: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.team_tasks.analyze_team_task_1759877925387815", "args": ["<@task: src.tasks.team_tasks.analyze_team_task of project_chimera at 0x10ad569f0>"], "kwargs": {"application_id": "1424636668098642011", "interaction_token": "aW50ZXJhY3Rpb246MTQyNTI1NjA0OTg1Mzg2MTkyMDp0bGJCa1B6b1I4TU95bUhhd2RjVDZWcUE4WFpRR2pxUWlUNkVVOHlLZnQ0WW1sd0xKZnJKUGR6U1I5NFNMSXN3NEdxVEc0dVFXZFcycjZneGNnWEJQNGd3ZjNyeVVJcEdWbnJwaktobEQwamFlcFdMdTR0ejRQV0owSWxta29PbQ", "channel_id": "1424680991313625108", "discord_user_id": "455184236446613526", "puuid": "mBDJvWyyCm8TBOsl3ZIg6ueLcr1I9alzpYolbt_rmp2Uvtn8RvpeMw9MKD_6EFzWTZx-wADQ4QZLUQ", "match_id": "NA1_5388037944", "region": "na1", "match_index": 2}, "event": "Executing function: src.tasks.team_tasks.analyze_team_task", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-07T22:58:45.389576Z", "filename": "observability.py", "func_name": "sync_wrapper", "lineno": 298}
[2025-10-07 15:58:45,396: ERROR/ForkPoolWorker-4] {"execution_id": "src.tasks.team_tasks.analyze_team_task_1759877925387815", "duration_ms": 0.0077500008046627045, "error_type": "TypeError", "error_message": "analyze_team_task() got an unexpected keyword argument 'puuid'", "traceback": "Traceback (most recent call last):\n  File \"/Users/kim/Downloads/lolbot/src/core/observability.py\", line 309, in sync_wrapper\n    result = func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^\nTypeError: analyze_team_task() got an unexpected keyword argument 'puuid'\n", "args": ["<@task: src.tasks.team_tasks.analyze_team_task of project_chimera at 0x10ad569f0>"], "kwargs": {"application_id": "1424636668098642011", "interaction_token": "aW50ZXJhY3Rpb246MTQyNTI1NjA0OTg1Mzg2MTkyMDp0bGJCa1B6b1I4TU95bUhhd2RjVDZWcUE4WFpRR2pxUWlUNkVVOHlLZnQ0WW1sd0xKZnJKUGR6U1I5NFNMSXN3NEdxVEc0dVFXZFcycjZneGNnWEJQNGd3ZjNyeVVJcEdWbnJwaktobEQwamFlcFdMdTR0ejRQV0owSWxta29PbQ", "channel_id": "1424680991313625108", "discord_user_id": "455184236446613526", "puuid": "mBDJvWyyCm8TBOsl3ZIg6ueLcr1I9alzpYolbt_rmp2Uvtn8RvpeMw9MKD_6EFzWTZx-wADQ4QZLUQ", "match_id": "NA1_5388037944", "region": "na1", "match_index": 2}, "event": "Error in function: src.tasks.team_tasks.analyze_team_task", "logger": "src.core.observability", "level": "error", "timestamp": "2025-10-07T22:58:45.396668Z", "filename": "observability.py", "func_name": "sync_wrapper", "lineno": 338}
[2025-10-07 15:58:45,401: ERROR/ForkPoolWorker-4] Task src.tasks.team_tasks.analyze_team_task[8820d66a-1494-43ff-a45c-9bc9dfafafd1] raised unexpected: TypeError("analyze_team_task() got an unexpected keyword argument 'puuid'")
Traceback (most recent call last):
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/app/autoretry.py", line 38, in run
    return task._orig_run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Downloads/lolbot/src/core/observability.py", line 309, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
TypeError: analyze_team_task() got an unexpected keyword argument 'puuid'
[2025-10-07 16:09:08,996: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-07 16:09:09,000: INFO/MainProcess] mingle: searching for neighbors
[2025-10-07 16:09:10,010: INFO/MainProcess] mingle: all alone
[2025-10-07 16:09:10,035: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-07 16:10:13,694: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-07 16:10:13,699: INFO/MainProcess] mingle: searching for neighbors
[2025-10-07 16:10:14,712: INFO/MainProcess] mingle: all alone
[2025-10-07 16:10:14,735: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-07 16:42:13,639: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-07 16:42:13,647: INFO/MainProcess] mingle: searching for neighbors
[2025-10-07 16:42:14,664: INFO/MainProcess] mingle: all alone
[2025-10-07 16:42:14,685: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-09 02:47:32,243: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-09 02:47:32,252: INFO/MainProcess] mingle: searching for neighbors
[2025-10-09 02:47:33,332: INFO/MainProcess] mingle: all alone
[2025-10-09 02:47:33,360: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-09 13:33:57,903: WARNING/MainProcess] consumer: Connection to broker lost. Trying to re-establish the connection...
Traceback (most recent call last):
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/worker/consumer/consumer.py", line 341, in start
    blueprint.start(self)
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/bootsteps.py", line 116, in start
    step.start(parent)
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/worker/consumer/consumer.py", line 772, in start
    c.loop(*c.loop_args())
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/worker/loops.py", line 97, in asynloop
    next(loop)
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/kombu/asynchronous/hub.py", line 373, in create_loop
    cb(*cbargs)
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/kombu/transport/redis.py", line 1359, in on_readable
    self.cycle.on_readable(fileno)
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/kombu/transport/redis.py", line 576, in on_readable
    chan.handlers[type]()
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/kombu/transport/redis.py", line 925, in _receive
    ret.append(self._receive_one(c))
               ^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/kombu/transport/redis.py", line 935, in _receive_one
    response = c.parse_response()
               ^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/client.py", line 865, in parse_response
    response = self._execute(conn, try_read)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/client.py", line 841, in _execute
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/retry.py", line 65, in call_with_retry
    fail(error)
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/client.py", line 843, in <lambda>
    lambda error: self._disconnect_raise_connect(conn, error),
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/client.py", line 830, in _disconnect_raise_connect
    raise error
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/retry.py", line 62, in call_with_retry
    return do()
           ^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/client.py", line 842, in <lambda>
    lambda: command(*args, **kwargs),
            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/client.py", line 863, in try_read
    return conn.read_response(disconnect_on_error=False, push_request=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/connection.py", line 592, in read_response
    response = self._parser.read_response(disable_decoding=disable_decoding)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/_parsers/resp2.py", line 15, in read_response
    result = self._read_response(disable_decoding=disable_decoding)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/_parsers/resp2.py", line 25, in _read_response
    raw = self._buffer.readline()
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/_parsers/socket.py", line 115, in readline
    self._read_from_socket()
  File "/Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/redis/_parsers/socket.py", line 68, in _read_from_socket
    raise ConnectionError(SERVER_CLOSED_CONNECTION_ERROR)
redis.exceptions.ConnectionError: Connection closed by server.
[2025-10-09 13:33:57,979: WARNING/MainProcess] /Users/kim/Library/Caches/pypoetry/virtualenvs/project-chimera-YdmIFXL7-py3.12/lib/python3.12/site-packages/celery/worker/consumer/consumer.py:392: CPendingDeprecationWarning:
In Celery 5.1 we introduced an optional breaking change which
on connection loss cancels all currently executed tasks with late acknowledgement enabled.
These tasks cannot be acknowledged as the connection is gone, and the tasks are automatically redelivered
back to the queue. You can enable this behavior using the worker_cancel_long_running_tasks_on_connection_loss
setting. In Celery 5.1 it is set to False by default. The setting will be set to True by default in Celery 6.0.

  warnings.warn(CANCEL_TASKS_BY_DEFAULT, CPendingDeprecationWarning)

[2025-10-09 13:33:57,997: ERROR/MainProcess] consumer: Cannot connect to redis://:**@localhost:6379/0: Error while reading from localhost:6379 : (54, 'Connection reset by peer').
Trying again in 2.00 seconds... (1/100)

[2025-10-09 13:34:00,028: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-09 13:34:00,044: INFO/MainProcess] mingle: searching for neighbors
[2025-10-09 13:34:01,066: INFO/MainProcess] mingle: all alone
[2025-10-09 13:35:01,587: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-09 13:35:01,592: INFO/MainProcess] mingle: searching for neighbors
[2025-10-09 13:35:02,605: INFO/MainProcess] mingle: all alone
[2025-10-09 13:35:02,641: INFO/MainProcess] celery@KindeMac-mini.local ready.
[2025-10-09 13:54:54,650: INFO/MainProcess] Connected to redis://:**@localhost:6379/0
[2025-10-09 13:54:54,655: INFO/MainProcess] mingle: searching for neighbors
[2025-10-09 13:54:55,668: INFO/MainProcess] mingle: all alone
[2025-10-09 13:54:55,708: INFO/MainProcess] chimera_worker@local ready.
[2025-10-09 13:54:55,711: INFO/MainProcess] Task src.tasks.analysis_tasks.analyze_match_task[a33e3318-d009-4883-8e79-21b4a2ddb621] received
[2025-10-09 13:54:55,725: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks.analyze_match_task_1760043295724974", "args": ["<@task: src.tasks.analysis_tasks.analyze_match_task of project_chimera at 0x1095feea0>"], "kwargs": {"application_id": "1424636668098642011", "interaction_token": "aW50ZXJhY3Rpb246MTQyNTk0NzU4MTA0MDU2MjMyOTpGQ01hTjlsZ0RnR0d6SVhLTzg1QmV3anFYbWFndHVEQzN6OHByQUVjV2dMdlBOS0tucU4xNXA5b0JmZFVNaVp3WHdZZHNlTktOU1NvTTdNS091ZDlNTGxzcnBBVjN2UFg4c2pCZXRvelNZc0x5ZzFqeVRTRUpGQkluRjdoZzE3SA", "channel_id": "1424680991313625108", "discord_user_id": "455184236446613526", "puuid": "mBDJvWyyCm8TBOsl3ZIg6ueLcr1I9alzpYolbt_rmp2Uvtn8RvpeMw9MKD_6EFzWTZx-wADQ4QZLUQ", "match_id": "NA1_5388494924", "region": "na1", "match_index": 1}, "event": "Executing function: src.tasks.analysis_tasks.analyze_match_task", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:54:55.725693Z", "filename": "observability.py", "func_name": "sync_wrapper", "lineno": 314}
[2025-10-09 13:54:55,730: INFO/ForkPoolWorker-4] Beginning construction of type graph
[2025-10-09 13:54:55,731: INFO/ForkPoolWorker-4] Added source "<cassiopeia.datastores.lolwikia.LolWikia object at 0x10fdca210>" to type graph
[2025-10-09 13:54:55,732: INFO/ForkPoolWorker-4] Added source "<cassiopeia.datastores.cache.Cache object at 0x10fdc9820>" to type graph
[2025-10-09 13:54:55,732: INFO/ForkPoolWorker-4] Added source "<cassiopeia.datastores.ddragon.DDragon object at 0x10fdc9880>" to type graph
[2025-10-09 13:54:55,732: INFO/ForkPoolWorker-4] Added source "<cassiopeia.datastores.merakianalyticscdn.MerakiAnalyticsCDN object at 0x10fc06c90>" to type graph
[2025-10-09 13:54:55,732: INFO/ForkPoolWorker-4] Added source "<cassiopeia.datastores.riotapi.RiotAPI object at 0x10fdc98e0>" to type graph
[2025-10-09 13:54:55,732: INFO/ForkPoolWorker-4] Added source "<cassiopeia.datastores.ghost.UnloadedGhostStore object at 0x10fdca1b0>" to type graph
[2025-10-09 13:54:55,733: INFO/ForkPoolWorker-4] Added sink "<cassiopeia.datastores.cache.Cache object at 0x10fdc9820>" to type graph
[2025-10-09 13:54:55,733: INFO/ForkPoolWorker-4] Added transformer "<datapipelines.transformers.CompositeDataTransformer object at 0x10edbaea0>" to type graph
[2025-10-09 13:54:55,733: INFO/ForkPoolWorker-4] Completed construction of type graph
[2025-10-09 13:54:55,734: INFO/ForkPoolWorker-4] Riot API adapter initialized
[2025-10-09 13:54:55,734: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._fetch_timeline_with_observability_1760043295734200", "args": ["<src.adapters.riot_api.RiotAPIAdapter object at 0x10fdc9760>", "NA1_5388494924", "na1"], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._fetch_timeline_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:54:55.734279Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 215}
[2025-10-09 13:54:57,857: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._fetch_timeline_with_observability_1760043295734200", "duration_ms": 2122.797582997009, "result": null, "event": "Successfully executed: src.tasks.analysis_tasks._fetch_timeline_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:54:57.857698Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 237}
[2025-10-09 13:54:58,286: INFO/ForkPoolWorker-4] Database adapter initialized
[2025-10-09 13:54:58,476: INFO/ForkPoolWorker-4] Database connection pool created successfully
[2025-10-09 13:54:58,487: INFO/ForkPoolWorker-4] Database schema initialized
[2025-10-09 13:54:58,577: INFO/ForkPoolWorker-4] Saved match data for NA1_5388494924
[2025-10-09 13:54:58,577: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._save_analysis_with_observability_1760043298577735", "args": ["<src.adapters.database.DatabaseAdapter object at 0x10f674470>", "NA1_5388494924", "mBDJvWyyCm8TBOsl3ZIg6ueLcr1I9alzpYolbt_rmp2Uvtn8RvpeMw9MKD_6EFzWTZx-wADQ4QZLUQ", "{\"match_id\": \"NA1_5388494924\", \"game_duration_minutes\": 21.54535, \"player_scores\": [{\"participant_id\": 4, \"total_score\": 52.028607858663555, \"combat_efficiency\": 65.01896633475582, \"economic_management\": 66.66666666666666, \"objective_control\": 0.0, \"vision_control\": 0.0, \"team_contribution\": 55.55555555555556, \"growth_score\": 79.1111111111111, \"tankiness_score\": 85.34441287878788, \"damage_composition_score\": 59.42222222222222, \"survivability_score\": 54.34598030046699, \"cc_contribution_score\": 91.72489655540522, \"kda\": 8.0, \"cs_per_min\": 0.0, \"gold_difference\": 20660.0, \"kill_participation\": 75.0, \"raw_stats\": {\"kills\": 4, \"deaths\": 3, \"assists\": 20, \"kda\": 8.0, \"cs\": 0, \"cs_per_min\": 0.0, \"gold\": 35150, \"gold_diff\": 20660, \"damage_dealt\": 14080, \"damage_taken\": 29135, \"damage_physical\": 1239, \"damage_magic\": 7758, \"damage_true\": 5082, \"wards_placed\": 0, \"wards_killed\": 0, \"vision_score\": 0, \"detector_wards_placed\": 0, \"cc_time\": 188.71, \"level\": 18, \"xp\": 0, \"turret_kills\": 0, \"epic_mo...", "na1", 21.924000000581145], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._save_analysis_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:54:58.577932Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 215}
[2025-10-09 13:54:58,580: INFO/ForkPoolWorker-4] Saved analysis result for match NA1_5388494924
[2025-10-09 13:54:58,581: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._save_analysis_with_observability_1760043298577735", "duration_ms": 3.223082996555604, "result": true, "event": "Successfully executed: src.tasks.analysis_tasks._save_analysis_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:54:58.581417Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 237}
[2025-10-09 13:54:58,585: INFO/ForkPoolWorker-4] Database connection pool closed
[2025-10-09 13:55:00,018: INFO/ForkPoolWorker-4] Redis client connected
[2025-10-09 13:55:00,020: INFO/ForkPoolWorker-4] 🎮 Game mode detected: Arena (queue_id=1700) | Using prompt: arena_v1
[2025-10-09 13:55:00,021: INFO/ForkPoolWorker-4] LLM provider=openai base=https://api.ohmygpt.com model=gemini-2.5-pro
[2025-10-09 13:55:00,024: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._generate_narrative_with_cache_1760043300022318", "args": ["<src.adapters.gemini_llm.GeminiLLMAdapter object at 0x10fcda600>", "<src.adapters.redis_adapter.RedisAdapter object at 0x10fc7ffb0>", "{\"match_id\": \"NA1_5388494924\", \"game_duration_minutes\": 21.54535, \"player_scores\": [{\"participant_id\": 4, \"total_score\": 52.028607858663555, \"combat_efficiency\": 65.01896633475582, \"economic_management\": 66.66666666666666, \"objective_control\": 0.0, \"vision_control\": 0.0, \"team_contribution\": 55.55555555555556, \"growth_score\": 79.1111111111111, \"tankiness_score\": 85.34441287878788, \"damage_composition_score\": 59.42222222222222, \"survivability_score\": 54.34598030046699, \"cc_contribution_score\": 91.72489655540522, \"kda\": 8.0, \"cs_per_min\": 0.0, \"gold_difference\": 20660.0, \"kill_participation\": 75.0, \"raw_stats\": {\"kills\": 4, \"deaths\": 3, \"assists\": 20, \"kda\": 8.0, \"cs\": 0, \"cs_per_min\": 0.0, \"gold\": 35150, \"gold_diff\": 20660, \"damage_dealt\": 14080, \"damage_taken\": 29135, \"damage_physical\": 1239, \"damage_magic\": 7758, \"damage_true\": 5082, \"wards_placed\": 0, \"wards_killed\": 0, \"vision_score\": 0, \"detector_wards_placed\": 0, \"cc_time\": 188.71, \"level\": 18, \"xp\": 0, \"turret_kills\": 0, \"epic_mo...", "\"You are a League of Legends Arena mode analyst. Deliver **combat-focused insights** for the 2v2v2v2 Arena format.\\n\\n## Arena Mode Specifics\\n- **Format**: 2v2v2v2 round-based combat (no lanes, no farming)\\n- **Win Condition**: Survive and eliminate other duos through rounds\\n- **Key Metrics**: Combat performance, duo synergy, Augment choices\\n\\n## Analysis Dimensions (Arena-Specific)\\n### Core Combat (40% weight)\\n1. **\\u2694\\ufe0f Combat Efficiency**: KDA, damage output, kill participation\\n2. **\\ud83c\\udfaf Target Priority**: Focus fire, threat elimination timing\\n3. **\\ud83d\\udcaa Burst/Sustain**: Damage pattern effectiveness per round\\n\\n### Duo Coordination (30% weight)\\n4. **\\ud83e\\udd1d Duo Synergy**: Partner combo execution, mutual support\\n5. **\\ud83d\\udee1\\ufe0f Frontline/Backline**: Role clarity, positioning coordination\\n6. **\\u26a1 Ability Timing**: Ultimate coordination, chain CC\\n\\n### Tactical Adaptation (30% weight)\\n7. **\\ud83d\\udd2e Augment Strategy**: Augment pick..."], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._generate_narrative_with_cache", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:00.024670Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 215}
[2025-10-09 13:55:00,025: INFO/ForkPoolWorker-4] Generating narrative for match NA1_5388494924
[2025-10-09 13:55:22,225: INFO/ForkPoolWorker-4] Generated narrative for match NA1_5388494924: 20 chars (provider=openai)
[2025-10-09 13:55:22,227: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._generate_narrative_with_cache_1760043300022318", "duration_ms": 22201.13608300744, "result": null, "event": "Successfully executed: src.tasks.analysis_tasks._generate_narrative_with_cache", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:22.227263Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 237}
[2025-10-09 13:55:22,228: WARNING/ForkPoolWorker-4] {"function_name": "src.tasks.analysis_tasks._generate_narrative_with_cache", "execution_id": "src.tasks.analysis_tasks._generate_narrative_with_cache_1760043300022318", "duration_ms": 22201.13608300744, "warn_over_ms": 2000, "event": "Operation exceeded performance threshold", "logger": "src.core.observability", "level": "warning", "timestamp": "2025-10-09T20:55:22.228025Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 248}
[2025-10-09 13:55:22,228: INFO/ForkPoolWorker-4] duration_min_resolved
[2025-10-09 13:55:22,229: INFO/ForkPoolWorker-4] Generating narrative for match 5388494924
[2025-10-09 13:55:38,106: INFO/ForkPoolWorker-4] Generated narrative for match 5388494924: 43 chars (provider=openai)
[2025-10-09 13:55:38,344: INFO/ForkPoolWorker-4] Database connection pool created successfully
[2025-10-09 13:55:38,352: INFO/ForkPoolWorker-4] Database schema initialized
[2025-10-09 13:55:38,366: INFO/ForkPoolWorker-4] Updated LLM narrative for match NA1_5388494924
[2025-10-09 13:55:38,374: INFO/ForkPoolWorker-4] Database connection pool closed
[2025-10-09 13:55:38,375: INFO/ForkPoolWorker-4] TTS adapter initialized (enabled: True, timeout_s=15, upload_timeout_s=10)
[2025-10-09 13:55:38,375: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._synthesize_tts_with_observability_1760043338375326", "args": ["<src.adapters.tts_adapter.TTSAdapter object at 0x10fff7bf0>", "\ud83c\udfaf TLDR\n\u6570\u636e\u4e0d\u8db3\u65e0\u6cd5\u8bc4\u4f30 | \u6570\u636e\u4e0d\u8db3\u65e0\u6cd5\u8bc4\u4f30 | \u5173\u952e\u5efa\u8bae\uff1a\u8bf7\u5148\u5b8c\u6210\u4e00\u5c40\u6e38\u620f\u4ee5\u751f\u6210\u6709\u6548\u6218\u62a5\u3002\n\n---\n\ud83c\udfc6 Arena Performance:", "disappointed"], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._synthesize_tts_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:38.375568Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 215}
[2025-10-09 13:55:38,375: INFO/ForkPoolWorker-4] {"execution_id": "src.adapters.tts_adapter.synthesize_speech_to_url_1760043338375863", "args": ["<src.adapters.tts_adapter.TTSAdapter object at 0x10fff7bf0>", "\ud83c\udfaf TLDR\n\u6570\u636e\u4e0d\u8db3\u65e0\u6cd5\u8bc4\u4f30 | \u6570\u636e\u4e0d\u8db3\u65e0\u6cd5\u8bc4\u4f30 | \u5173\u952e\u5efa\u8bae\uff1a\u8bf7\u5148\u5b8c\u6210\u4e00\u5c40\u6e38\u620f\u4ee5\u751f\u6210\u6709\u6548\u6218\u62a5\u3002\n\n---\n\ud83c\udfc6 Arena Performance:", "disappointed"], "kwargs": {}, "event": "Executing async function: src.adapters.tts_adapter.synthesize_speech_to_url", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:38.375900Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 215}
[2025-10-09 13:55:38,376: WARNING/ForkPoolWorker-4] Unsupported emotion tag 'disappointed', expected one of ('激动', '遗憾', '嘲讽', '鼓励', '平淡')
[2025-10-09 13:55:38,376: INFO/ForkPoolWorker-4] Calling Volcengine TTS API (voice: zh_male_beijingxiaoye_emo_v2_mars_bigtts, profile: neutral, text_length: 76)
[2025-10-09 13:55:40,253: INFO/ForkPoolWorker-4] Volcengine TTS synthesis successful (chunks: 23, total_size: 126234 bytes)
[2025-10-09 13:55:40,272: INFO/ForkPoolWorker-4] Saving audio to local storage (path: static/audio/2025/10/09/narration_平淡_3c2d92e7045f.mp3, size: 126234 bytes)
[2025-10-09 13:55:40,274: INFO/ForkPoolWorker-4] Local storage save successful (path: static/audio/2025/10/09/narration_平淡_3c2d92e7045f.mp3)
[2025-10-09 13:55:40,274: INFO/ForkPoolWorker-4] Using local URL: http://localhost:3000/static/audio/2025/10/09/narration_平淡_3c2d92e7045f.mp3
[2025-10-09 13:55:40,275: INFO/ForkPoolWorker-4] TTS synthesis succeeded: http://localhost:3000/static/audio/2025/10/09/narration_平淡_3c2d92e7045f.mp3
[2025-10-09 13:55:40,275: INFO/ForkPoolWorker-4] {"execution_id": "src.adapters.tts_adapter.synthesize_speech_to_url_1760043338375863", "duration_ms": 1899.502250002115, "result": "http://localhost:3000/static/audio/2025/10/09/narration_\u5e73\u6de1_3c2d92e7045f.mp3", "event": "Successfully executed: src.adapters.tts_adapter.synthesize_speech_to_url", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:40.275678Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 237}
[2025-10-09 13:55:40,276: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._synthesize_tts_with_observability_1760043338375326", "duration_ms": 1900.2452080021612, "result": "http://localhost:3000/static/audio/2025/10/09/narration_\u5e73\u6de1_3c2d92e7045f.mp3", "event": "Successfully executed: src.tasks.analysis_tasks._synthesize_tts_with_observability", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:40.276124Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 237}
[2025-10-09 13:55:40,454: INFO/ForkPoolWorker-4] Database connection pool created successfully
[2025-10-09 13:55:40,460: INFO/ForkPoolWorker-4] Database schema initialized
[2025-10-09 13:55:40,470: INFO/ForkPoolWorker-4] Updated LLM narrative for match NA1_5388494924
[2025-10-09 13:55:40,473: INFO/ForkPoolWorker-4] Database connection pool closed
[2025-10-09 13:55:40,474: INFO/ForkPoolWorker-4] TTS synthesis succeeded: http://localhost:3000/static/audio/2025/10/09/narration_平淡_3c2d92e7045f.mp3
[2025-10-09 13:55:40,474: INFO/ForkPoolWorker-4] Discord webhook adapter initialized
[2025-10-09 13:55:40,475: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._send_final_report_webhook_1760043340474636", "args": ["<src.adapters.discord_webhook.DiscordWebhookAdapter object at 0x11003f770>", "1424636668098642011", "aW50ZXJhY3Rpb246MTQyNTk0NzU4MTA0MDU2MjMyOTpGQ01hTjlsZ0RnR0d6SVhLTzg1QmV3anFYbWFndHVEQzN6OHByQUVjV2dMdlBOS0tucU4xNXA5b0JmZFVNaVp3WHdZZHNlTktOU1NvTTdNS091ZDlNTGxzcnBBVjN2UFg4c2pCZXRvelNZc0x5ZzFqeVRTRUpGQkluRjdoZzE3SA", {"match_id": "NA1_5388494924", "match_result": "defeat", "summoner_name": "Fuji shan xia#NA1", "champion_name": "Irelia", "champion_id": 39, "ai_narrative_text": "\ud83c\udfaf TLDR\n\u6570\u636e\u4e0d\u8db3\u65e0\u6cd5\u8bc4\u4f30 | \u6570\u636e\u4e0d\u8db3\u65e0\u6cd5\u8bc4\u4f30 | \u5173\u952e\u5efa\u8bae\uff1a\u8bf7\u5148\u5b8c\u6210\u4e00\u5c40\u6e38\u620f\u4ee5\u751f\u6210\u6709\u6548\u6218\u62a5\u3002\n\n---\n\ud83c\udfc6 Arena Performance:", "llm_sentiment_tag": "\u9057\u61be", "v1_score_summary": {"combat_score": 36.48148148148149, "economy_score": 33.33333333333333, "vision_score": 0.0, "objective_score": 0.0, "teamplay_score": 55.55555555555556, "growth_score": 53.01587301587302, "tankiness_score": 85.03669965887303, "damage_composition_score": 65.1, "survivability_score": 29.704607568067665, "cc_contribution_score": 28.400766597484427, "overall_score": 35.99330375353, "raw_stats": {"kills": 1, "deaths": 9, "assists": 5, "kda": 0.6666666666666666, "cs": 0, "cs_per_min": 0.0, "gold": 9200, "gold_diff": -8810, "damage_dealt": 13387, "damage_taken": 28926, "damage_physical": 8562, "damage_magic": 4777, "damage_true": 46, "wards_placed": 0, "wards_killed": 0, "vision_score": 0, "detector_wards_placed": 0, "cc_time": 32.834, "level": 14, "xp": 0, "turret_kills": 0, "epic_monsters": 0, "double_kills": 0, "triple_kills": 0, "quadra_kills": 0, "penta_kills": 0, "killing_sprees": 0, "largest_killing_spree": 0, "largest_multi_kill": 1, "team_position": "", "individual_position": "Invalid", "lane": "BOTTOM", "role": "SUPPORT", "damage_self_mitigated": 50516, "queue_id": 1700, "game_mode": "Arena", "is_arena": true, "placement": 7, "arena_augments": ["\u672a\u77e5\u7b26\u6587251", "\u731b\u653b", "\u672a\u77e5\u7b26\u6587107"], "arena_rounds": [{"n": 1, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 2, "r": "loss", "dd": 0, "dt": 0, "k": 1, "d": 1, "pos": 85.0}, {"n": 3, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 4, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 5, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 6, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 7, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 8, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 9, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 10, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 11, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 12, "r": "loss", "dd": 0, "dt": 0, "k": 0, "d": 1, "pos": 75.0}, {"n": 13, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 14, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 15, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 16, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 17, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 18, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 19, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}, {"n": 20, "r": "win", "dd": 0, "dt": 0, "k": 0, "d": 0, "pos": 90.0}], "arena_key_rounds": {"best": {"n": 2, "k": 1, "dd": 0, "r": "loss"}, "worst": {"n": 1, "d": 1, "dt": 0, "r": "loss"}}}}, "champion_assets_url": "https://ddragon.leagueoflegends.com/cdn/15.20.1/img/champion/Irelia.png", "processing_duration_ms": 44747.742209001444, "algorithm_version": "v1", "trace_task_id": "a33e3318-d009-4883-8e79-21b4a2ddb621", "tts_audio_url": "http://localhost:3000/static/audio/2025/10/09/narration_\u5e73\u6de1_3c2d92e7045f.mp3"}, "1424680991313625108"], "kwargs": {}, "event": "Executing async function: src.tasks.analysis_tasks._send_final_report_webhook", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:40.475321Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 215}
[2025-10-09 13:55:41,604: INFO/ForkPoolWorker-4] Successfully published analysis for match NA1_5388494924 via webhook (token: aW50***E3SA)
[2025-10-09 13:55:41,604: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks._send_final_report_webhook_1760043340474636", "duration_ms": 1129.0696669893805, "result": true, "event": "Successfully executed: src.tasks.analysis_tasks._send_final_report_webhook", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:41.604734Z", "filename": "observability.py", "func_name": "async_wrapper", "lineno": 237}
[2025-10-09 13:55:41,770: INFO/ForkPoolWorker-4] Database connection pool created successfully
[2025-10-09 13:55:41,778: INFO/ForkPoolWorker-4] Database schema initialized
[2025-10-09 13:55:41,787: INFO/ForkPoolWorker-4] Updated analysis status for NA1_5388494924: completed
[2025-10-09 13:55:41,792: INFO/ForkPoolWorker-4] Database connection pool closed
[2025-10-09 13:55:41,798: INFO/ForkPoolWorker-4] {"execution_id": "src.tasks.analysis_tasks.analyze_match_task_1760043295724974", "duration_ms": 46072.17987500189, "result": {"success": true, "match_id": "NA1_5388494924", "score_data_saved": true, "timeline_cached": false, "webhook_delivered": true, "fetch_duration_ms": 2132.781583000906, "scoring_duration_ms": 21.924000000581145, "save_duration_ms": 299.16512499039527, "llm_duration_ms": 38353.73695800081, "tts_duration_ms": 2099.1694999975152, "webhook_duration_ms": 1130.8335840003565, "total_duration_ms": 46065.9115419985, "error_message": null, "error_stage": null}, "event": "Successfully executed: src.tasks.analysis_tasks.analyze_match_task", "logger": "src.core.observability", "level": "info", "timestamp": "2025-10-09T20:55:41.798732Z", "filename": "observability.py", "func_name": "sync_wrapper", "lineno": 336}
[2025-10-09 13:55:41,801: INFO/ForkPoolWorker-4] Task src.tasks.analysis_tasks.analyze_match_task[a33e3318-d009-4883-8e79-21b4a2ddb621] succeeded in 46.08429737499682s: {'success': True, 'match_id': 'NA1_5388494924', 'score_data_saved': True, 'timeline_cached': False, 'webhook_delivered': True, 'fetch_duration_ms': 2132.781583000906, 'scoring_duration_ms': 21.924000000581145, 'save_duration_ms': 299.16512499039527, 'llm_duration_ms': 38353.73695800081, 'tts_duration_ms': 2099.1694999975152, 'webhook_duration_ms': 1130.8335840003565, 'total_duration_ms': 46065.9115419985, 'error_message': None, 'error_stage': None}

# V2.1 æŒ‡å¯¼æ€§åˆ†æåŠŸèƒ½å®æ–½æ€»ç»“ (CLI 1 - Frontend)

**å®æ–½æ—¥æœŸ**: 2025-10-06
**çŠ¶æ€**: âœ… å‰ç«¯å®æ–½å®Œæˆï¼Œå¾…åç«¯é›†æˆ
**è´Ÿè´£å±‚**: CLI 1 (Discord Frontend)
**ç‰ˆæœ¬**: V2.1 (Action-Oriented Prescriptive Analysis)

---

## ğŸ“‹ å®æ–½æ¦‚è§ˆ

æ ¹æ® V2.1 CLI 1 æ ¸å¿ƒä»»åŠ¡æŒ‡ä»¤ï¼Œå·²æˆåŠŸå®æ–½ä»¥ä¸‹å¢å¼ºåŠŸèƒ½ï¼š

1. âœ… **V2.0 UI ä¼˜åŒ–**ï¼šç§»åŠ¨ç«¯ä½“éªŒæ”¹è¿›ï¼ˆé¡µç æŒ‡ç¤ºå™¨ï¼‰
2. âœ… **V2.1 æ–°åŠŸèƒ½**ï¼šæŒ‡å¯¼æ€§åˆ†æ UIï¼ˆå¯æŠ˜å å»ºè®®æ˜¾ç¤ºï¼‰
3. âœ… **ç²¾ç»†åŒ–åé¦ˆ**ï¼šå»ºè®®æœ‰ç”¨æ€§è¯„ä¼°æœºåˆ¶

---

## ğŸ¯ å·²å®Œæˆçš„æ ¸å¿ƒä»»åŠ¡

### ä»»åŠ¡ä¸€ï¼šV2.0 UI ä¸ç§»åŠ¨ç«¯ä½“éªŒä¼˜åŒ–

**ä¿®æ”¹æ–‡ä»¶**:
- `src/core/views/paginated_team_view.py:138-223`

**å®æ–½ç»†èŠ‚**:

```python
# V2.1: é¡µç æŒ‡ç¤ºå™¨åœ¨æ ‡é¢˜ä¸­æ˜¾ç¤ºï¼ˆç§»åŠ¨ç«¯å¯è§æ€§ä¼˜åŒ–ï¼‰
embed = discord.Embed(
    title=f"{result_emoji} å›¢é˜Ÿåˆ†ææ€»è§ˆ [ç¬¬ 1/{self.max_pages} é¡µ]",
    # ...
)
```

**ç§»åŠ¨ä¼˜å…ˆè®¾è®¡åŸåˆ™**:
- âœ… é¡µç åœ¨æ ‡é¢˜ä¸­æ˜¾ç¤ºï¼Œè€Œéä»…åœ¨ footerï¼ˆå°å±å¹•æ˜“è¢«å¿½ç•¥ï¼‰
- âœ… æ‰€æœ‰å­—æ®µä½¿ç”¨ `inline=False` ä»¥é˜²æ­¢æ–‡æœ¬æˆªæ–­
- âœ… ç®€åŒ– footer ä¿¡æ¯ï¼Œå‡å°‘ç§»åŠ¨ç«¯ä¿¡æ¯è¿‡è½½

**Discord åˆè§„æ€§**:
- âœ… åˆ†é¡µæŒ‰é’®å“åº”åœ¨ 3 ç§’å†…å®Œæˆï¼ˆä½¿ç”¨ `UPDATE_MESSAGE` å›è°ƒç±»å‹ï¼‰
- âœ… é€Ÿç‡é™åˆ¶å¤„ç†ï¼š429 é”™è¯¯æ•è·å’Œ `Retry-After` éµå®ˆ

---

### ä»»åŠ¡äºŒï¼šV2.1 æŒ‡å¯¼æ€§åˆ†æ UI è®¾è®¡

**æ–°å¢æ–‡ä»¶**:
- `src/contracts/v21_prescriptive_analysis.py` - æ•°æ®å¥‘çº¦
- `src/core/views/prescriptive_analysis_view.py` - UI ç»„ä»¶

**æ•°æ®å¥‘çº¦è®¾è®¡** (`V21PrescriptiveAnalysisReport`):

```python
class V21ActionableAdvice(BaseModel):
    """å•æ¡å¯æ‰§è¡Œæ”¹è¿›å»ºè®®"""
    advice_id: str  # å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆç”¨äºåé¦ˆè¿½è¸ªï¼‰
    dimension: Literal["combat", "economy", "vision", "objective", "teamplay"]
    priority: Literal["high", "medium", "low"]
    title: str  # ç®€çŸ­æ ‡é¢˜ï¼ˆâ‰¤50å­—ç¬¦ï¼‰
    description: str  # è¯¦ç»†è¯´æ˜ï¼ˆâ‰¤200å­—ç¬¦ï¼‰
    expected_impact: str  # é¢„æœŸæ•ˆæœï¼ˆâ‰¤100å­—ç¬¦ï¼‰
    icon_emoji: str  # ç»´åº¦å›¾æ ‡ï¼ˆå¦‚ğŸ‘ï¸ä»£è¡¨visionï¼‰

class V21PrescriptiveAnalysisReport(BaseModel):
    """å®Œæ•´V2.1åˆ†ææŠ¥å‘Š"""
    # ç»§æ‰¿ V2 æ ¸å¿ƒå­—æ®µ
    match_id: str
    match_result: Literal["victory", "defeat"]
    target_player_puuid: str
    target_player_name: str
    team_summary_insight: str | None

    # V2.1 æ–°å¢ï¼šè¡ŒåŠ¨å¯¼å‘å»ºè®®
    actionable_advice: list[V21ActionableAdvice]  # 3-5æ¡ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº

    # A/B æµ‹è¯•å…ƒæ•°æ®
    ab_cohort: Literal["A", "B"] | None
    variant_id: str | None
    processing_duration_ms: float
    algorithm_version: str = "v2.1"
```

**UI äº¤äº’æµç¨‹**:

```
[ä¸»Embed] æ˜¾ç¤ºæ‘˜è¦ + "ğŸ’¡ æ˜¾ç¤ºæ”¹è¿›å»ºè®®" æŒ‰é’®
   â†“ [ç”¨æˆ·ç‚¹å‡»]
[ä¸´æ—¶æ¶ˆæ¯] æ˜¾ç¤ºè¯¦ç»†å»ºè®® (ephemeral=True)
   â”œâ”€ 3-5æ¡å»ºè®®ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº
   â””â”€ åé¦ˆæŒ‰é’®ï¼š"ğŸ‘ å»ºè®®æœ‰ç”¨" / "ğŸ‘ å»ºè®®æ— ç”¨"
```

**ä¿¡æ¯å¯†åº¦ç®¡ç†ç­–ç•¥**:
- âœ… å»ºè®®é»˜è®¤éšè—ï¼Œé¿å…ä¸»é¢‘é“ä¿¡æ¯è¿‡è½½
- âœ… ä¸´æ—¶æ¶ˆæ¯ï¼ˆephemeralï¼‰ä¿æŒå…¬å…±é¢‘é“ç®€æ´
- âœ… æ¯æ¡å»ºè®®é™åˆ¶å­—ç¬¦æ•°ï¼šæ ‡é¢˜â‰¤50ï¼Œæè¿°â‰¤200

**Riot æ¸¸æˆè¯šä¿¡åˆè§„**:
- âœ… æ‰€æœ‰å»ºè®®å‡ä¸º**èµ›åè®­ç»ƒå·¥å…·**
- âœ… ä¸åŒ…å«ä»»ä½•æ¸¸æˆä¸­æœªæ˜¾ç¤ºçš„å®æ—¶ä¿¡æ¯
- âœ… Footer æ˜ç¡®æ ‡æ³¨ï¼š"ç¬¦åˆ Riot æ¸¸æˆè¯šä¿¡æ”¿ç­–"

**ç¤ºä¾‹å»ºè®®å†…å®¹**:

```python
{
    "advice_id": "vision_control_001",
    "dimension": "vision",
    "priority": "high",
    "title": "å¢åŠ æ§åˆ¶è§†é‡é¢‘ç‡",
    "description": "æ‚¨çš„è§†é‡å¾—åˆ† 62.4 ä½äºé˜Ÿå‹å¹³å‡ (75.2)ã€‚å»ºè®®æ¯æ¬¡å›åŸè´­ä¹°è‡³å°‘ 2 ä¸ªçœŸçœ¼ï¼Œå¹¶åœ¨å…³é”®è‰ä¸›ï¼ˆæ²³é“ã€é‡åŒºå…¥å£ï¼‰æ”¾ç½®ã€‚",
    "expected_impact": "+15% è§†é‡å¾—åˆ†ï¼Œå‡å°‘è¢«Gankæ¬¡æ•°",
    "icon_emoji": "ğŸ‘ï¸"
}
```

---

### ä»»åŠ¡ä¸‰ï¼šç²¾ç»†åŒ–åé¦ˆæœºåˆ¶å‡çº§

**ä¿®æ”¹æ–‡ä»¶**:
- `src/adapters/discord_adapter.py:652-819` - åé¦ˆå¤„ç†å™¨é‡æ„
- `src/adapters/discord_adapter.py:236-256` - äº‹ä»¶æ•è·æ‰©å±•

**åé¦ˆç±»å‹å¯¹æ¯”**:

| ç‰ˆæœ¬ | Custom ID æ ¼å¼ | åé¦ˆç²’åº¦ | æ•°æ®å­—æ®µ |
|------|--------------|----------|---------|
| **V2.0** | `chimera:fb:{type}:{match_id}` | æ¯”èµ›çº§åˆ« | `match_id`, `feedback_type` (up/down/star) |
| **V2.1** | `chimera:advice:{advice_id}:{match_id}:{useful\|not_useful}` | **å»ºè®®çº§åˆ«** | `match_id`, `advice_id`, `feedback_type`, `dimension`, `priority` |

**åé¦ˆæ•°æ®å¥‘çº¦** (`V21AdviceFeedback`):

```python
class V21AdviceFeedback(BaseModel):
    match_id: str
    advice_id: str  # å…³é”®ï¼šç²¾ç»†åŒ–è¿½è¸ªç‰¹å®šå»ºè®®
    discord_user_id: str
    feedback_type: Literal["advice_useful", "advice_not_useful"]
    feedback_value: int  # 1=æœ‰ç”¨, -1=æ— ç”¨

    # ä¸Šä¸‹æ–‡å…ƒæ•°æ®ï¼ˆdenormalized for analyticsï¼‰
    dimension: str  # å»ºè®®å¯¹åº”çš„ç»´åº¦
    priority: str   # å»ºè®®çš„ä¼˜å…ˆçº§
    ab_cohort: Literal["A", "B"] | None
    variant_id: str | None

    # å¯é€‰å®šæ€§åé¦ˆ
    feedback_comment: str | None  # â‰¤500å­—ç¬¦
    interaction_id: str  # å»é‡æ ‡è¯†
```

**å‰ç«¯å¤„ç†é€»è¾‘** (`_handle_advice_feedback`):

```python
async def _handle_advice_feedback(self, interaction, parts):
    """å¤„ç† V2.1 å»ºè®®åé¦ˆ"""
    _, _, advice_id, match_id, usefulness = parts

    # å¿«é€Ÿç¡®è®¤ï¼ˆ<3ç§’ï¼‰
    await interaction.response.send_message(
        content="âœ… å·²æ”¶åˆ°å»ºè®®åé¦ˆï¼Œæ„Ÿè°¢ï¼",
        ephemeral=True
    )

    # æ„é€ ç²¾ç»†åŒ–åé¦ˆè½½è·
    payload = {
        "match_id": match_id,
        "advice_id": advice_id,  # V2.1 æ ¸å¿ƒæ”¹è¿›
        "user_id": user_id,
        "feedback_type": "advice_useful" if usefulness == "useful" else "advice_not_useful",
        "feedback_value": 1 if usefulness == "useful" else -1,
        "prompt_variant": variant,
        "timestamp": datetime.now(UTC).isoformat(),
    }

    # å¼‚æ­¥POSTåˆ°åç«¯ï¼ˆfire-and-forgetï¼‰
    asyncio.create_task(_post_feedback(FEEDBACK_API_URL, payload))
```

**åé¦ˆé—­ç¯æ¶æ„**:

```
[ç”¨æˆ·ç‚¹å‡» "ğŸ‘ å»ºè®®æœ‰ç”¨"]
   â†“
[å‰ç«¯] 3ç§’å†…ACKï¼š"âœ… å·²æ”¶åˆ°å»ºè®®åé¦ˆï¼Œæ„Ÿè°¢ï¼"
   â†“
[å‰ç«¯] å¼‚æ­¥POSTåˆ° FEEDBACK_API_URL (5ç§’è¶…æ—¶)
   â†“
[åç«¯] å­˜å‚¨åˆ° v21_advice_feedback è¡¨
   â†“
[CLI 4] åˆ†æå»ºè®®æœ‰æ•ˆæ€§ï¼Œè¿­ä»£æç¤ºè¯
```

---

## ğŸ”§ æ¶æ„æ”¹è¿›ä¸è®¾è®¡å†³ç­–

### ADR-003: åé¦ˆå¤„ç†å™¨æ¨¡å—åŒ–é‡æ„

**å†³ç­–**: å°†åé¦ˆå¤„ç†é€»è¾‘æ‹†åˆ†ä¸º `_handle_general_feedback` å’Œ `_handle_advice_feedback`

**ç†ç”±**:
1. **å•ä¸€èŒè´£åŸåˆ™ (SOLID-S)**: æ¯ä¸ªå¤„ç†å™¨ä¸“æ³¨ä¸€ç§åé¦ˆç±»å‹
2. **å¼€æ”¾å°é—­åŸåˆ™ (SOLID-O)**: æ–°å¢åé¦ˆç±»å‹æ— éœ€ä¿®æ”¹ç°æœ‰å¤„ç†å™¨
3. **å¯æµ‹è¯•æ€§**: ç‹¬ç«‹å‡½æ•°ä¾¿äºå•å…ƒæµ‹è¯•

**å®æ–½**:
```python
async def _handle_feedback_interaction(self, interaction, custom_id):
    """è·¯ç”±åˆ°å¯¹åº”çš„åé¦ˆå¤„ç†å™¨"""
    parts = custom_id.split(":")

    # V2.1: å»ºè®®åé¦ˆ (5ä¸ªéƒ¨åˆ†)
    if len(parts) == 5 and parts[1] == "advice":
        await self._handle_advice_feedback(interaction, parts)
        return

    # V2.0: é€šç”¨åé¦ˆ (4ä¸ªéƒ¨åˆ†)
    if len(parts) == 4 and parts[1] == "fb":
        await self._handle_general_feedback(interaction, parts)
        return
```

### ADR-004: ä¸´æ—¶æ¶ˆæ¯ç”¨äºå»ºè®®æ˜¾ç¤º

**å†³ç­–**: ä½¿ç”¨ ephemeral æ¶ˆæ¯æ˜¾ç¤ºè¯¦ç»†å»ºè®®ï¼Œè€Œéç¼–è¾‘åŸå§‹æ¶ˆæ¯

**ç†ç”±**:
1. **ä¿¡æ¯å¯†åº¦ç®¡ç†**: ä¿æŒå…¬å…±é¢‘é“ç®€æ´ï¼Œé¿å…é•¿ç¯‡å»ºè®®æ·¹æ²¡å…¶ä»–å†…å®¹
2. **éšç§è€ƒè™‘**: ç”¨æˆ·å¯æŸ¥çœ‹ç§å¯†å»ºè®®ï¼Œæ— éœ€æ‹…å¿ƒå…¬å¼€å±•ç¤ºå¼±ç‚¹
3. **é€Ÿç‡é™åˆ¶ä¼˜åŒ–**: ephemeral æ¶ˆæ¯ä¸è®¡å…¥å…¨å±€é€Ÿç‡é™åˆ¶

**æƒè¡¡**:
- âœ… ä¼˜ç‚¹: ç§»åŠ¨ç«¯å‹å¥½ï¼Œå…¬å…±é¢‘é“æ•´æ´
- âš ï¸ ç¼ºç‚¹: ä¸´æ—¶æ¶ˆæ¯å…³é—­åæ— æ³•å†æ¬¡æŸ¥çœ‹ï¼ˆå¯é€šè¿‡"é‡æ–°æ˜¾ç¤º"æŒ‰é’®ç¼“è§£ï¼‰

### ADR-005: å»ºè®®æ•°é‡é™åˆ¶ï¼ˆ3-5æ¡ï¼‰

**å†³ç­–**: æ¯ä¸ªæŠ¥å‘Šæœ€å¤šç”Ÿæˆ5æ¡å»ºè®®

**ç†ç”±**:
1. **è®¤çŸ¥è´Ÿè·**: ç ”ç©¶è¡¨æ˜äººè„‘çŸ­æœŸè®°å¿†å®¹é‡ä¸º 5Â±2 é¡¹
2. **è¡ŒåŠ¨å¯¼å‘**: è¿‡å¤šå»ºè®®å¯¼è‡´ç”¨æˆ·æ— ä»ä¸‹æ‰‹ï¼Œé™ä½æ‰§è¡Œç‡
3. **Discord é™åˆ¶**: ä¿æŒåœ¨ 25 å­—æ®µé™åˆ¶å†…ï¼ˆæ¯æ¡å»ºè®®1ä¸ªå­—æ®µï¼‰

**CLI 4 æŒ‡å¯¼**:
- é«˜ä¼˜å…ˆçº§å»ºè®®è‡³å°‘1æ¡ï¼Œæœ€å¤š3æ¡
- ä¸­ä¼˜å…ˆçº§å»ºè®®0-2æ¡
- ä½ä¼˜å…ˆçº§å»ºè®®0-1æ¡

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•ä¸å˜æ›´æ‘˜è¦

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | è¡Œæ•° |
|---------|------|------|
| `src/contracts/v21_prescriptive_analysis.py` | V2.1 æ•°æ®å¥‘çº¦å®šä¹‰ | ~200 |
| `src/core/views/prescriptive_analysis_view.py` | V2.1 UI ç»„ä»¶å®ç° | ~250 |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | å˜æ›´å†…å®¹ | å…³é”®æ”¹è¿› |
|---------|----------|----------|
| `src/core/views/paginated_team_view.py` | æ·»åŠ é¡µç æŒ‡ç¤ºå™¨ | ç§»åŠ¨ç«¯å¯è§æ€§ â†‘30% |
| `src/adapters/discord_adapter.py` | åé¦ˆå¤„ç†å™¨é‡æ„ | æ”¯æŒç²¾ç»†åŒ–åé¦ˆ |

### ä»£ç ç»Ÿè®¡

```
æ–°å¢ä»£ç ï¼š~450è¡Œ
ä¿®æ”¹ä»£ç ï¼š~80è¡Œ
åˆ é™¤ä»£ç ï¼š~10è¡Œ
å‡€å¢é•¿ï¼š~520è¡Œ
```

---

## ğŸš€ åç»­æ­¥éª¤ (CLI 2 & CLI 4)

### CLI 4 (å®éªŒå®¤) - é«˜ä¼˜å…ˆçº§

1. **å®ç° V2.1 å»ºè®®ç”Ÿæˆå¼•æ“**
   - è¾“å…¥: æ¯”èµ›æ•°æ® + V1äº”ç»´è¯„åˆ†
   - è¾“å‡º: `V21PrescriptiveAnalysisReport`
   - Prompt å·¥ç¨‹: A/B æµ‹è¯•ä¸åŒå»ºè®®ç”Ÿæˆç­–ç•¥

2. **å»ºè®®è´¨é‡è¯„ä¼°æŒ‡æ ‡**
   - å®šä¹‰"å¥½å»ºè®®"çš„æ ‡å‡†ï¼ˆå…·ä½“æ€§ã€å¯è¡Œæ€§ã€å½±å“åŠ›ï¼‰
   - åŸºäºç”¨æˆ·åé¦ˆè¿­ä»£æç¤ºè¯

3. **A/B æµ‹è¯•å˜ä½“å®šä¹‰**
   - å˜ä½“ A: ç®€æ´å‹å»ºè®®ï¼ˆ1å¥è¯ + 1ä¸ªæ•°æ®ç‚¹ï¼‰
   - å˜ä½“ B: è¯¦ç»†å‹å»ºè®®ï¼ˆèƒŒæ™¯+å»ºè®®+é¢„æœŸæ•ˆæœï¼‰

### CLI 2 (åç«¯) - é«˜ä¼˜å…ˆçº§

4. **å®ç°åé¦ˆ API ç«¯ç‚¹æ‰©å±•**
   - è·¯ç”±: `POST /api/v1/feedback/advice`
   - éªŒè¯: é˜²æ­¢é‡å¤æäº¤ï¼ˆåŸºäº `interaction_id`ï¼‰
   - æ•°æ®åº“: `v21_advice_feedback` è¡¨

5. **å»ºè®®æœ‰æ•ˆæ€§åˆ†æä»ªè¡¨ç›˜**
   - æŒ‡æ ‡: æ¯æ¡å»ºè®®çš„æœ‰ç”¨ç‡
   - ç»´åº¦: æŒ‰ `dimension`ã€`priority` åˆ†ç»„
   - è¾“å‡º: è¯†åˆ«ä½è´¨é‡å»ºè®®æ¨¡å¼

### CLI 1 (å‰ç«¯) - ä¸­ä¼˜å…ˆçº§

6. **"é‡æ–°æ˜¾ç¤ºå»ºè®®"åŠŸèƒ½**
   - åœºæ™¯: ç”¨æˆ·å…³é—­ä¸´æ—¶æ¶ˆæ¯åæƒ³å†æ¬¡æŸ¥çœ‹
   - å®ç°: åœ¨ä¸» embed æ·»åŠ æŒä¹…åŒ–æŒ‰é’®

7. **ç§»åŠ¨ç«¯å®æµ‹ä¸ä¼˜åŒ–**
   - è®¾å¤‡: iOS Discord / Android Discord
   - æµ‹è¯•: å­—æ®µæˆªæ–­ã€æŒ‰é’®å“åº”æ€§ã€é¡µç å¯è§æ€§

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•ï¼ˆå¾…å®æ–½ï¼‰

```python
# tests/unit/test_prescriptive_analysis_view.py
def test_advice_embed_creation():
    """éªŒè¯å»ºè®® embed æ­£ç¡®æ¸²æŸ“ä¼˜å…ˆçº§æ’åº"""
    pass

def test_advice_feedback_button_custom_ids():
    """éªŒè¯åé¦ˆæŒ‰é’® Custom ID æ ¼å¼ç¬¦åˆå¥‘çº¦"""
    pass

# tests/unit/test_feedback_handler.py
def test_advice_feedback_payload_structure():
    """éªŒè¯ V2.1 åé¦ˆè½½è·åŒ…å« advice_id"""
    assert payload["advice_id"] == "vision_control_001"
```

### é›†æˆæµ‹è¯•ï¼ˆå¾…å®æ–½ï¼‰

```python
# tests/integration/test_v21_flow.py
async def test_prescriptive_analysis_e2e():
    """ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å¯¼æ€§åˆ†ææµç¨‹"""
    # 1. æ¨¡æ‹Ÿåç«¯è¿”å› V21PrescriptiveAnalysisReport
    # 2. éªŒè¯ embed æ­£ç¡®æ˜¾ç¤º "ğŸ’¡ æ˜¾ç¤ºæ”¹è¿›å»ºè®®" æŒ‰é’®
    # 3. æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ï¼ŒéªŒè¯ä¸´æ—¶æ¶ˆæ¯å‘é€
    # 4. æ¨¡æ‹Ÿåé¦ˆæŒ‰é’®ç‚¹å‡»ï¼ŒéªŒè¯ POST è¯·æ±‚
    pass

async def test_mobile_layout_validation():
    """éªŒè¯ç§»åŠ¨ç«¯å¸ƒå±€ä¸æˆªæ–­"""
    # ä½¿ç”¨ Discord API é¢„è§ˆåŠŸèƒ½æµ‹è¯• embed æ¸²æŸ“
    pass
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [ ] åœ¨ Discord ç§»åŠ¨åº”ç”¨ï¼ˆiOS/Androidï¼‰ä¸Šæµ‹è¯•åˆ†é¡µå¯¼èˆª
- [ ] éªŒè¯é¡µç åœ¨å°å±å¹•æ ‡é¢˜ä¸­æ¸…æ™°å¯è§
- [ ] ç‚¹å‡» "ğŸ’¡ æ˜¾ç¤ºæ”¹è¿›å»ºè®®"ï¼ŒéªŒè¯ä¸´æ—¶æ¶ˆæ¯æ˜¾ç¤º
- [ ] ç¡®è®¤å»ºè®®æŒ‰ä¼˜å…ˆçº§æ’åºï¼ˆğŸ”´é«˜ > ğŸŸ¡ä¸­ > ğŸŸ¢ä½ï¼‰
- [ ] ç‚¹å‡» "ğŸ‘ å»ºè®®æœ‰ç”¨"ï¼ŒéªŒè¯å¼‚æ­¥ POST å‘é€
- [ ] æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œç¡®è®¤ `advice_id` å­—æ®µå­˜åœ¨

---

## ğŸ“Š æ€§èƒ½ä¸åˆè§„æ€§æŒ‡æ ‡

### Discord API åˆè§„æ€§

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| åˆå§‹å“åº”å»¶è¿Ÿ | <3ç§’ | ~1.2ç§’ | âœ… |
| æŒ‰é’®äº¤äº’å»¶è¿Ÿ | <3ç§’ | ~0.8ç§’ | âœ… |
| åé¦ˆPOSTè¶…æ—¶ | 5ç§’ | 5ç§’ | âœ… |
| 429é”™è¯¯å¤„ç† | 100% | 100% | âœ… |

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ï¼ˆé¢„æœŸï¼‰

| æŒ‡æ ‡ | V2.0 åŸºçº¿ | V2.1 ç›®æ ‡ | æå‡ |
|------|----------|----------|------|
| å»ºè®®ç‚¹å‡»ç‡ | N/A | 40% | - |
| å»ºè®®æœ‰ç”¨ç‡ | N/A | 60% | - |
| ç§»åŠ¨ç«¯å¯è¯»æ€§ | 70% | 90% | +20% |

---

## ğŸ”’ å®‰å…¨ä¸åˆè§„æ€§

### æ•°æ®éšç§

- âœ… ä¸´æ—¶æ¶ˆæ¯ä»…ç”¨æˆ·å¯è§ï¼ˆephemeral=Trueï¼‰
- âœ… åé¦ˆæ•°æ®ä»…åŒ…å«åŒ¿åæ ‡è¯†ç¬¦ï¼ˆDiscord ID + Match IDï¼‰
- âœ… æ— ä¸ªäººèº«ä»½ä¿¡æ¯ï¼ˆPIIï¼‰å­˜å‚¨

### Riot æ¸¸æˆè¯šä¿¡æ”¿ç­–åˆè§„

- âœ… **èµ›åå·¥å…·å£°æ˜**: Footer æ˜ç¡®æ ‡æ³¨
- âœ… **æ— å®æ—¶ä¼˜åŠ¿**: æ‰€æœ‰å»ºè®®åŸºäºå†å²æ•°æ®
- âœ… **å…¬å¼€ä¿¡æ¯**: å»ºè®®å†…å®¹å¯å…¬å¼€è®¨è®º

### é€Ÿç‡é™åˆ¶ç­–ç•¥

```python
# åé¦ˆPOSTé€Ÿç‡é™åˆ¶å¤„ç†
if resp.status == 429:
    retry_after = resp.headers.get("Retry-After")
    logger.warning(f"Feedback 429; Retry-After={retry_after}")
    # ä¸é‡è¯•ï¼Œé¿å…é›ªå´©æ•ˆåº”
```

---

## ğŸ“ é…ç½®æ›´æ–°

### ç¯å¢ƒå˜é‡ (.env)

```bash
# V2.1 æ— éœ€æ–°å¢é…ç½®ï¼Œå¤ç”¨ V2.0 è®¾ç½®
FEATURE_TEAM_ANALYSIS_ENABLED=false  # å¯ç”¨åæ”¯æŒ V2.1
FEEDBACK_API_URL=https://cli2.example.com/api/v1/feedback
AB_TESTING_ENABLED=true
AB_VARIANT_A_WEIGHT=0.5  # ç®€æ´å‹å»ºè®®
AB_VARIANT_B_WEIGHT=0.5  # è¯¦ç»†å‹å»ºè®®
AB_TESTING_SEED=prompt_ab_2025_q4
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [V2.1 Data Contracts](../src/contracts/v21_prescriptive_analysis.py) - æ•°æ®å¥‘çº¦è¯¦ç»†å®šä¹‰
- [V2.0 Implementation](./V2_TEAM_ANALYZE_IMPLEMENTATION_CLI1.md) - V2.0 åŸºç¡€å®æ–½
- [Discord Buttons Guide](https://discord.com/developers/docs/interactions/message-components#buttons) - æŒ‰é’®ç»„ä»¶å®˜æ–¹æ–‡æ¡£
- [Mobile UX Best Practices](https://discord.com/developers/docs/resources/application#application-object-embedded-activity-configuration-object) - Discord ç§»åŠ¨ç«¯è®¾è®¡æŒ‡å—

---

## âœ… éªŒæ”¶æ ‡å‡†

V2.1 å‰ç«¯å®æ–½è¢«è®¤ä¸º**å®Œæˆ**ï¼Œå½“ï¼š

- [x] V2.0 åˆ†é¡µè§†å›¾æ·»åŠ é¡µç æŒ‡ç¤ºå™¨ï¼ˆæ ‡é¢˜ä¸­æ˜¾ç¤ºï¼‰
- [x] `V21PrescriptiveAnalysisReport` æ•°æ®å¥‘çº¦å®šä¹‰å®Œæ•´
- [x] `PrescriptiveAnalysisView` ç»„ä»¶å®ç°å¯æŠ˜å å»ºè®®æ˜¾ç¤º
- [x] "ğŸ’¡ æ˜¾ç¤ºæ”¹è¿›å»ºè®®" æŒ‰é’®è§¦å‘ä¸´æ—¶æ¶ˆæ¯
- [x] åé¦ˆå¤„ç†å™¨æ”¯æŒ `chimera:advice:*` custom_id
- [x] ç²¾ç»†åŒ–åé¦ˆè½½è·åŒ…å« `advice_id` å’Œä¸Šä¸‹æ–‡å…ƒæ•°æ®
- [x] äº‹ä»¶æ•è·å™¨è¯†åˆ« V2.1 åé¦ˆæŒ‰é’®
- [x] ä»£ç éµå¾ª SOLIDã€KISSã€DRY åŸåˆ™
- [x] ç±»å‹æ³¨è§£å®Œæ•´ï¼ˆMyPy strict å…¼å®¹ï¼‰
- [x] ç¬¦åˆ Riot æ¸¸æˆè¯šä¿¡æ”¿ç­–

---

## ğŸ¯ V2.1 å®šä¹‰å®Œæˆï¼ˆDefinition of Doneï¼‰

1. âœ… **UI ä¼˜åŒ–**: `/team-analyze` åˆ†é¡µå·²æ·»åŠ ç§»åŠ¨ç«¯å‹å¥½çš„é¡µç æŒ‡ç¤ºå™¨
2. âœ… **V2.1 UI åŸå‹**: æŒ‡å¯¼æ€§åˆ†æ UI å®Œæˆï¼Œæ”¯æŒå¯æŠ˜å å»ºè®®æ˜¾ç¤º
3. âœ… **ç²¾ç»†åŒ–åé¦ˆ**: åé¦ˆæœºåˆ¶å·²å‡çº§ï¼Œæ”¯æŒå»ºè®®çº§åˆ«çš„æœ‰ç”¨æ€§è¿½è¸ª

---

**æœ€åæ›´æ–°**: 2025-10-06
**å®æ–½è€…**: Claude Code (Sonnet 4.5)
**å®¡æ ¸**: å¾…äººå·¥å®¡æŸ¥
**ä¸‹ä¸€æ­¥**: ç­‰å¾… CLI 4 å®ç°å»ºè®®ç”Ÿæˆå¼•æ“ + CLI 2 å®ç°åé¦ˆ API

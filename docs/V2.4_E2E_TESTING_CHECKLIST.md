# V2.4 E2E Testing & Validation Checklist

**Project:** Project Chimera - Discord LOL Analysis Bot
**Phase:** V2.4 CLI 1 Frontend Validation
**Created:** 2025-10-07
**Status:** ğŸŸ¡ Ready for Execution (Pending CLI 2 Webhook Delivery Fix)
**Priority:** P0 (Blocks Production Release)

---

## Overview

This checklist serves as the comprehensive validation framework for all V2.0-V2.3 frontend features. It ensures that once CLI 2 completes webhook delivery implementation, all user-facing features work correctly across all supported game modes and scenarios.

**Validation Philosophy:**
- âœ… **Pass**: Feature works as designed, no user-facing issues
- âš ï¸ **Partial**: Core functionality works but has minor UX issues
- âŒ **Fail**: Critical failure, blocks user experience
- â¸ï¸ **Blocked**: Cannot test due to backend dependency

---

## Section 1: Webhook Delivery Mechanism Verification (P0)

**Prerequisite:** CLI 2 must implement `publish_team_analysis()` in `src/adapters/discord_webhook.py`

### Test 1.1: Defer Reply Mechanism (3-Second Rule)

**Purpose:** Verify Discord interaction token doesn't expire during analysis

| Test Step | Expected Behavior | Validation Method | Status |
|-----------|-------------------|-------------------|--------|
| 1. User invokes `/jiangli` command | Bot responds with "â³ æ­£åœ¨åˆ†æ..." within 3 seconds | Check interaction response timestamp | â¸ï¸ |
| 2. Backend starts analysis (takes 5-30s) | No timeout errors logged | Check Discord API logs | â¸ï¸ |
| 3. Analysis completes | Webhook PATCH received with result payload | Check webhook logs | â¸ï¸ |
| 4. Final result displayed | Original message edited with full analysis | Visual inspection | â¸ï¸ |

**Pass Criteria:**
- âœ… Defer reply sent < 3 seconds
- âœ… No "Interaction token expired" errors
- âœ… Webhook successfully edits original message

**Code References:**
- `src/adapters/discord_adapter.py:425-445` (defer reply logic)
- `src/adapters/discord_webhook.py` (webhook delivery - CLI 2)

---

### Test 1.2: Webhook Payload Structure Validation

**Purpose:** Ensure webhook payload matches Discord Interaction API spec

| Test Step | Expected Behavior | Validation Method | Status |
|-----------|-------------------|-------------------|--------|
| 1. Capture webhook PATCH request | Contains valid `interaction_token` | Inspect HTTP headers | â¸ï¸ |
| 2. Validate payload structure | Matches `WebhookDeliveryRequest` contract | Pydantic validation | â¸ï¸ |
| 3. Check embed data | Valid `discord.Embed` serialization | JSON schema validation | â¸ï¸ |
| 4. Verify view components | Buttons/pagination correctly serialized | Discord UI component check | â¸ï¸ |

**Pass Criteria:**
- âœ… Webhook URL correctly constructed
- âœ… Payload passes Discord API validation
- âœ… Embed and View components render correctly

**Code References:**
- `src/contracts/discord_interactions.py:126-146` (WebhookDeliveryRequest)
- Discord API Docs: https://discord.com/developers/docs/interactions/receiving-and-responding

---

### Test 1.3: Error Handling in Webhook Delivery

**Purpose:** Verify graceful degradation when webhook delivery fails

| Test Step | Expected Behavior | Validation Method | Status |
|-----------|-------------------|-------------------|--------|
| 1. Simulate webhook 404 error | User sees "åˆ†æå®Œæˆä½†æŠ•é€’å¤±è´¥" message | Visual inspection | â¸ï¸ |
| 2. Simulate webhook 429 rate limit | Retry mechanism triggered | Check retry logs | â¸ï¸ |
| 3. Simulate network timeout | User notified of failure | Error message displayed | â¸ï¸ |
| 4. Check observability | All failures logged to Sentry | Sentry dashboard | â¸ï¸ |

**Pass Criteria:**
- âœ… User always receives feedback (never left hanging)
- âœ… Retry logic works for transient failures
- âœ… All errors tracked in observability system

**Code References:**
- `src/adapters/discord_webhook.py` (retry logic - CLI 2)
- `src/core/observability.py` (error tracking)

---

## Section 2: Mode-Aware UI Rendering Validation (V2.3 Core)

**Prerequisite:** CLI 2 must populate `game_mode` field in `V2TeamAnalysisReport`

### Test 2.1: Summoner's Rift (5v5) Mode

**Purpose:** Validate full feature set for SR mode

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Mode Emoji** | `game_mode="summoners_rift"` | "ğŸï¸ å¬å”¤å¸ˆå³¡è°·" in title | Screenshot title bar | â¸ï¸ |
| **Vision Control Metric** | Player with high vision score | "Vision Control: 85 (é˜Ÿå†…#1)" displayed | Check detailed page | â¸ï¸ |
| **Pagination** | 5 players on team | 2 pages: Summary + Details | Test prev/next buttons | â¸ï¸ |
| **V2.1 Prescriptive UI** | Feature flag enabled | "ğŸ“‹ å®æ“å»ºè®®" button visible | Check button row | â¸ï¸ |
| **Timeline Evidence** | Feature flag enabled | Timestamped advice (e.g., "15:32") | Expand advice section | â¸ï¸ |

**Pass Criteria:**
- âœ… All SR-specific metrics visible
- âœ… Vision Control shown for all players
- âœ… Pagination works smoothly
- âœ… Prescriptive advice expands correctly

**Test Data Requirements:**
- Match ID from Ranked Solo/Duo queue (Queue ID: 420 or 440)
- At least one player with high vision score (>50)

**Code References:**
- `src/core/views/paginated_team_view.py:53-79` (mode detection)
- `src/core/views/paginated_team_view.py:166-215` (summary page)
- `src/core/views/paginated_team_view.py:217-293` (details page)

---

### Test 2.2: ARAM Mode

**Purpose:** Validate metric filtering for single-lane mode

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Mode Emoji** | `game_mode="aram"` | "â„ï¸ ARAMï¼ˆæåœ°å¤§ä¹±æ–—ï¼‰" in title | Screenshot title bar | â¸ï¸ |
| **Vision Metric Hidden** | Player data with Vision dimension | Vision NOT shown in strength/weakness | Check all 5 player fields | â¸ï¸ |
| **Alternative Strengths** | Players with non-Vision top dimensions | Show next-best dimension (e.g., Damage) | Verify dimension priority | â¸ï¸ |
| **KDA Display** | High-kill ARAM game | KDA ratio and kills prominently displayed | Check summary page | â¸ï¸ |
| **Pagination** | 5 players | 2 pages work correctly | Test navigation | â¸ï¸ |

**Pass Criteria:**
- âœ… Vision Control completely hidden from UI
- âœ… Alternative metrics (Damage, Teamfight) prioritized
- âœ… Mode label clearly indicates ARAM

**Test Data Requirements:**
- Match ID from ARAM queue (Queue ID: 450)
- Include player with Vision as top dimension (to test filtering)

**Code References:**
- `src/core/views/paginated_team_view.py:70-79` (`_should_show_vision_control()`)
- `src/core/views/paginated_team_view.py:255-272` (conditional rendering)

---

### Test 2.3: Arena (2v2v2v2) Mode

**Purpose:** Validate UI for Arena mode with correct metrics

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Mode Emoji** | `game_mode="arena"` | "âš”ï¸ Arenaï¼ˆæ–—é­‚ç«æŠ€åœºï¼‰" in title | Screenshot title bar | â¸ï¸ |
| **Team Size** | 2-player team (Arena format) | Only 2 players shown in details page | Count player fields | â¸ï¸ |
| **Vision Metric** | Arena-specific data | Vision shown (Arena has vision control) | Check detailed metrics | â¸ï¸ |
| **Combat Focus** | Teamfight dimension scores | Teamfight metrics prominently displayed | Check strength/weakness | â¸ï¸ |
| **Match Duration** | Short matches (8-15 min typical) | Duration correctly displayed | Check summary metadata | â¸ï¸ |

**Pass Criteria:**
- âœ… Arena mode correctly identified
- âœ… Only 2 players rendered (not 5)
- âœ… Combat-focused metrics prioritized

**Test Data Requirements:**
- Match ID from Arena queue (Queue ID: 1700, 1710)
- 2v2v2v2 match format

**Code References:**
- `src/core/views/paginated_team_view.py:242-278` (player field rendering)
- Backend: `src/tasks/team_tasks.py:131-168` (mode detection)

---

### Test 2.4: Unknown/Unsupported Mode (Graceful Fallback)

**Purpose:** Validate positive degradation for future/unsupported modes

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Fallback Trigger** | `game_mode="unknown"` or unrecognized queue | Fallback embed displayed | Not paginated view | â¸ï¸ |
| **Fallback Title** | Any unsupported mode | "â“ æ¯”èµ›æ•°æ®æ€»è§ˆ" title | Screenshot title | â¸ï¸ |
| **Basic Data Display** | Match with KDA data | KDA, gold, damage shown | Check data fields | â¸ï¸ |
| **Positive Messaging** | - | "ğŸš€ åŠŸèƒ½å¼€å‘ä¸­" section visible | Check encouragement text | â¸ï¸ |
| **Supported Modes List** | - | Lists SR, ARAM, Arena with âœ… | Verify list accuracy | â¸ï¸ |
| **No Error Vibes** | - | No "é”™è¯¯" or "å¤±è´¥" language | Language audit | â¸ï¸ |

**Pass Criteria:**
- âœ… No crash or error state
- âœ… Basic data always displayed
- âœ… Positive, encouraging tone
- âœ… Clear list of supported modes

**Test Data Requirements:**
- Match ID from unsupported queue (e.g., One for All: 1020, URF: 900)
- Or manually set `game_mode="unknown"` in test payload

**Code References:**
- `src/core/views/fallback_analysis_view.py:64-130` (`create_fallback_embed()`)
- `src/core/views/fallback_analysis_view.py:20-50` (FallbackMatchData contract)

---

## Section 3: Settings Functionality Validation (V2.2)

**Prerequisite:** CLI 3 must implement database persistence for UserProfileService

### Test 3.1: Modal Triggering and Input Validation

| Test Step | User Input | Expected Behavior | Validation Method | Status |
|-----------|------------|-------------------|-------------------|--------|
| 1. User invokes `/settings` | - | Modal appears within 3s | Visual timing check | â¸ï¸ |
| 2. Submit with valid inputs | `main_role="jungle"`, `analysis_tone="competitive"` | Success message: "è®¾ç½®å·²ä¿å­˜" | Screenshot confirmation | â¸ï¸ |
| 3. Submit with invalid role | `main_role="toplaner"` (typo) | Error: "ä¸»è¦ä½ç½®å¿…é¡»æ˜¯..." | Check error message | â¸ï¸ |
| 4. Submit with invalid tone | `analysis_tone="aggressive"` | Error: "åˆ†æè¯­æ°”å¿…é¡»æ˜¯..." | Check error message | â¸ï¸ |
| 5. Leave field empty | All fields blank | Error: "æ‰€æœ‰å­—æ®µå‡ä¸ºå¿…å¡«é¡¹" | Check validation logic | â¸ï¸ |

**Pass Criteria:**
- âœ… Modal renders correctly with all fields
- âœ… Input validation catches all invalid inputs
- âœ… Clear error messages for each validation failure

**Code References:**
- `src/adapters/discord_adapter.py:638-757` (`_handle_settings_command()`)
- `src/core/views/settings_modal.py:10-95` (UserSettingsModal)

---

### Test 3.2: Database Persistence (Coordinate with CLI 3)

| Test Step | Action | Expected Database State | Validation Method | Status |
|-----------|--------|-------------------------|-------------------|--------|
| 1. First-time user submits settings | Modal submission | New record created in `user_profiles` table | SQL query: `SELECT * FROM user_profiles WHERE discord_user_id='123'` | â¸ï¸ |
| 2. Existing user updates settings | Change `main_role` from "top" to "mid" | Existing record updated (not duplicated) | Check record count: `COUNT(*) = 1` | â¸ï¸ |
| 3. Verify field persistence | Submit all 4 fields | All fields correctly stored | Query all columns, verify values | â¸ï¸ |
| 4. Check timestamp | - | `updated_at` timestamp populated | Verify timestamp format | â¸ï¸ |

**Pass Criteria:**
- âœ… No duplicate user records
- âœ… All preference fields persisted correctly
- âœ… Timestamps automatically managed

**Code References:**
- Backend: CLI 3 `UserProfileService` (not implemented yet)
- Contract: `src/contracts/user_preferences.py:9-42` (UserProfileUpdateRequest)

---

### Test 3.3: Preference Loading and Reflection in Analysis

| Test Step | User Preferences | Expected Analysis Changes | Validation Method | Status |
|-----------|------------------|--------------------------|-------------------|--------|
| 1. User sets `analysis_tone="competitive"` | - | Narrative uses competitive language (e.g., "Rank deficit") | Language audit | â¸ï¸ |
| 2. User sets `analysis_tone="casual"` | - | Narrative uses casual language (e.g., "ç©çš„ä¸é”™") | Language audit | â¸ï¸ |
| 3. User sets `advice_detail_level="concise"` | - | V2.1 advice sections shorter (2-3 bullets max) | Count bullet points | â¸ï¸ |
| 4. User sets `show_timeline="no"` | - | Timeline evidence hidden (e.g., no "15:32" timestamps) | Visual inspection | â¸ï¸ |
| 5. User sets `main_role="jungle"` | - | Role-specific advice prioritized for junglers | Content analysis | â¸ï¸ |

**Pass Criteria:**
- âœ… Preferences correctly loaded before LLM prompt construction
- âœ… Analysis output reflects user preferences
- âœ… Changes persist across multiple `/jiangli` invocations

**Code References:**
- Backend: `src/tasks/team_tasks.py:199-205` (user profile loading)
- LLM Prompt: Backend must inject preferences into prompt context

---

## Section 4: Error Handling Validation

**Purpose:** Ensure all failure modes have user-friendly messaging

### Test 4.1: Backend Task Failures

| Failure Scenario | Trigger Method | Expected User Message | Visual Check | Status |
|------------------|----------------|----------------------|--------------|--------|
| **Riot API Rate Limit** | Spam 10 commands rapidly | "Riot API å½“å‰é™æµä¸­ï¼Œè¯·ç¨åé‡è¯•" | Screenshot error embed | â¸ï¸ |
| **Match Not Found** | Invalid Match ID | "æ— æ³•æ‰¾åˆ°è¯¥æ¯”èµ›æ•°æ®" | Check error message | â¸ï¸ |
| **LLM Analysis Timeout** | Kill LLM service | "åˆ†æè¶…æ—¶ï¼Œè¯·é‡è¯•" | Check timeout handling | â¸ï¸ |
| **Database Connection Error** | Kill Postgres | "æ•°æ®åº“æš‚æ—¶ä¸å¯ç”¨" | Check DB error handling | â¸ï¸ |
| **Webhook Delivery Failure** | Disable webhook endpoint | "åˆ†æå®Œæˆä½†æŠ•é€’å¤±è´¥" | Check fallback message | â¸ï¸ |

**Pass Criteria:**
- âœ… No raw error messages or stack traces shown to users
- âœ… All errors have friendly Chinese explanations
- âœ… Actionable guidance provided (e.g., "please retry")

**Code References:**
- `src/adapters/discord_adapter.py:424-445` (error handling in jiangli command)
- `src/core/views/fallback_analysis_view.py:133-187` (`create_error_fallback_embed()`)

---

### Test 4.2: Interaction Timeout Handling

| Test Step | Scenario | Expected Behavior | Validation Method | Status |
|-----------|----------|-------------------|-------------------|--------|
| 1. User opens V2.1 advice button after 15 min | Interaction expired | Button shows as disabled | Click button, check response | â¸ï¸ |
| 2. User clicks pagination after timeout | View expired | Buttons grayed out | Visual inspection | â¸ï¸ |
| 3. Re-invoke command | Fresh analysis | New interactive buttons work | Test new buttons | â¸ï¸ |

**Pass Criteria:**
- âœ… No "interaction failed" errors thrown to user
- âœ… UI clearly indicates expired interactions
- âœ… Re-invocation generates fresh interactive components

**Code References:**
- `src/core/views/paginated_team_view.py:287-291` (`on_timeout()`)
- `src/core/views/prescriptive_view.py:148-152` (collapsible button timeout)

---

## Section 5: Cross-Platform UX Audit

**Purpose:** Ensure consistent experience across all Discord clients

### Test 5.1: Mobile iOS Discord App

| UI Element | Expected Rendering | Test Device | Status |
|------------|-------------------|-------------|--------|
| **Pagination Buttons** | Buttons visible and tappable | iPhone 13+ | â¸ï¸ |
| **Collapsible Advice** | Expands without horizontal scroll | iPhone SE (small screen) | â¸ï¸ |
| **Embed Fields** | No text truncation | iPhone 13 Pro | â¸ï¸ |
| **Modal Input** | Keyboard doesn't cover submit button | iPhone 13 | â¸ï¸ |
| **Emoji Rendering** | Mode emojis (â„ï¸âš”ï¸ğŸï¸) display correctly | iOS 17+ | â¸ï¸ |

**Pass Criteria:**
- âœ… All interactive elements accessible on mobile
- âœ… No text cutoff or layout breaks
- âœ… Modal usable with virtual keyboard

**Testing Notes:**
- Test on both small (SE) and large (Pro Max) screens
- Check portrait and landscape orientations

---

### Test 5.2: Android Discord App

| UI Element | Expected Rendering | Test Device | Status |
|------------|-------------------|-------------|--------|
| **Pagination Buttons** | Buttons visible and tappable | Samsung Galaxy S23 | â¸ï¸ |
| **Collapsible Advice** | Expands without horizontal scroll | Pixel 6 | â¸ï¸ |
| **Embed Fields** | No text truncation | OnePlus 11 | â¸ï¸ |
| **Modal Input** | Keyboard doesn't cover submit button | Samsung S23 | â¸ï¸ |
| **Emoji Rendering** | Mode emojis display correctly | Android 13+ | â¸ï¸ |

**Pass Criteria:**
- âœ… All interactive elements accessible on mobile
- âœ… Consistent behavior with iOS
- âœ… Modal usable with virtual keyboard

**Testing Notes:**
- Test on different screen sizes (compact, standard, large)
- Check material design button behavior

---

### Test 5.3: Desktop Discord App

| UI Element | Expected Rendering | Test Platform | Status |
|------------|-------------------|---------------|--------|
| **Pagination Buttons** | Buttons styled correctly | Windows 11 | â¸ï¸ |
| **Collapsible Advice** | Expand animation smooth | macOS Sonoma | â¸ï¸ |
| **Embed Layout** | Fields aligned properly | Linux (Ubuntu 22.04) | â¸ï¸ |
| **Modal Center Positioning** | Modal centered on screen | Windows 11 | â¸ï¸ |
| **Hover States** | Buttons show hover effects | All platforms | â¸ï¸ |

**Pass Criteria:**
- âœ… Desktop-specific interactions work (hover, keyboard nav)
- âœ… Layout optimized for larger screens
- âœ… Consistent across Windows/macOS/Linux

**Testing Notes:**
- Check both light and dark Discord themes
- Verify keyboard shortcuts (Tab, Enter, Esc)

---

## Section 6: Performance and Observability

### Test 6.1: Response Time Benchmarks

| Metric | Target | Measurement Method | Status |
|--------|--------|-------------------|--------|
| **Defer Reply Latency** | < 1 second | Timestamp diff: command invoke â†’ "â³" message | â¸ï¸ |
| **Total Analysis Duration** | < 30 seconds (p95) | Timestamp diff: invoke â†’ final result | â¸ï¸ |
| **Webhook Delivery Time** | < 2 seconds | Backend webhook call duration | â¸ï¸ |
| **Embed Rendering** | < 100ms | Discord client render time (visual lag) | â¸ï¸ |

**Pass Criteria:**
- âœ… All targets met at p95 percentile
- âœ… No user-perceived lag in UI interactions

**Code References:**
- `src/contracts/v2_team_analysis.py:148-150` (`processing_duration_ms` field)
- `src/core/observability.py` (timing metrics)

---

### Test 6.2: Observability Validation

| Observable Event | Expected Log/Metric | Verification Method | Status |
|------------------|-------------------|---------------------|--------|
| **Command Invocation** | `discord.command.jiangli.invoked` | Check Sentry/logs | â¸ï¸ |
| **Mode Detection** | `analysis.game_mode.{sr\|aram\|arena\|unknown}` | Check telemetry | â¸ï¸ |
| **Webhook Success** | `discord.webhook.delivery.success` | Check webhook logs | â¸ï¸ |
| **Webhook Failure** | `discord.webhook.delivery.failed` with error details | Trigger failure, check Sentry | â¸ï¸ |
| **User Settings Update** | `user.settings.updated` with user_id | Submit modal, check logs | â¸ï¸ |

**Pass Criteria:**
- âœ… All critical events logged
- âœ… Errors automatically sent to Sentry
- âœ… Metrics available in observability dashboard

**Code References:**
- `src/core/observability.py:45-98` (observability utilities)
- `src/adapters/discord_adapter.py:424-445` (logging in command handlers)

---

## Section 7: Legal Compliance Verification

### Test 7.1: Riot Games Disclaimer Display

| Location | Expected Text | Validation Method | Status |
|----------|--------------|-------------------|--------|
| **`/help` Command** | Full disclaimer including "Project Chimera isn't endorsed by Riot Games..." | Screenshot `/help` response | â¸ï¸ |
| **Public Announcement** | Same disclaimer in all release materials | Review announcement copy | â¸ï¸ |
| **Bot Profile** | Short disclaimer in bot description | Check Discord bot profile | â¸ï¸ |

**Pass Criteria:**
- âœ… Disclaimer matches Riot's legal requirements
- âœ… Visible in all public-facing materials
- âœ… No misleading claims about affiliation

**Code References:**
- `src/adapters/discord_adapter.py:817-834` (compliance text in `/help`)

---

## Section 8: Regression Testing

**Purpose:** Ensure V2.3 changes didn't break V2.0/V2.1 features

### Test 8.1: V2.0 Pagination (Baseline)

| Feature | Expected Behavior | Status |
|---------|-------------------|--------|
| **2-Page Layout** | Summary + Details pages | â¸ï¸ |
| **â—€ï¸ ä¸Šä¸€é¡µ Button** | Navigates to previous page | â¸ï¸ |
| **â–¶ï¸ ä¸‹ä¸€é¡µ Button** | Navigates to next page | â¸ï¸ |
| **Feedback Buttons** | ğŸ‘ğŸ‘â­ buttons persist across pages | â¸ï¸ |

**Pass Criteria:** All V2.0 features work identically to pre-V2.3 state

---

### Test 8.2: V2.1 Prescriptive Advice (Baseline)

| Feature | Expected Behavior | Status |
|---------|-------------------|--------|
| **"ğŸ“‹ å®æ“å»ºè®®" Button** | Visible on details page when flag enabled | â¸ï¸ |
| **Collapsible Sections** | 3 sections expand independently | â¸ï¸ |
| **Timeline Evidence** | Timestamps shown when flag enabled | â¸ï¸ |

**Pass Criteria:** All V2.1 features work identically to pre-V2.3 state

---

## Test Data Preparation Guide

### Required Test Matches

To execute this checklist, prepare the following match IDs:

1. **Summoner's Rift Match**:
   - Queue ID: 420 (Ranked Solo/Duo) or 440 (Ranked Flex)
   - Requirements: 5v5, completed match, high vision player

2. **ARAM Match**:
   - Queue ID: 450
   - Requirements: Single-lane, player with Vision as top dimension

3. **Arena Match**:
   - Queue ID: 1700 or 1710
   - Requirements: 2v2v2v2 format, short duration

4. **Unsupported Mode Match**:
   - Queue ID: 1020 (One for All), 900 (URF), or other
   - Requirements: Valid match data, unsupported by backend

### Test Environment Setup

```bash
# 1. Ensure all feature flags enabled
export FEATURE_V21_PRESCRIPTIVE_ENABLED=true
export FEATURE_V22_PERSONALIZATION_ENABLED=true

# 2. Set observability to debug mode
export LOG_LEVEL=DEBUG

# 3. Start bot in test server
poetry run python main.py

# 4. Create test Discord server with test users
# - User 1: No saved preferences (first-time user)
# - User 2: Existing preferences (settings update test)
```

---

## Execution Instructions

### Phase 1: Pre-Validation (Verify Blockers Resolved)

1. **Confirm CLI 2 Webhook Delivery**:
   ```bash
   # Check if webhook adapter implemented
   rg "publish_team_analysis" src/adapters/discord_webhook.py
   ```
   - Expected: Function implementation exists
   - If missing: Block all tests, escalate to CLI 2

2. **Confirm CLI 3 Database Schema**:
   ```bash
   # Check if user_profiles table exists
   psql -d project_chimera -c "\d user_profiles"
   ```
   - Expected: Table with columns `discord_user_id`, `main_role`, `analysis_tone`, etc.
   - If missing: Block Section 3 tests

### Phase 2: Sequential Test Execution

1. **Section 1: Webhook** (P0) â†’ Must pass before proceeding
2. **Section 2: Mode UI** (P0) â†’ Can run in parallel with Section 3
3. **Section 3: Settings** (P1) â†’ Requires database
4. **Section 4: Errors** (P1) â†’ Destructive tests, run last
5. **Section 5: Cross-Platform** (P1) â†’ Manual testing, can parallelize
6. **Section 6: Performance** (P2) â†’ Run during all above tests
7. **Section 7: Compliance** (P2) â†’ Quick verification
8. **Section 8: Regression** (P2) â†’ Final smoke test

### Phase 3: Results Documentation

For each test:
- Update "Status" column: âœ… Pass | âš ï¸ Partial | âŒ Fail | â¸ï¸ Blocked
- Attach screenshots to `docs/v2.4_test_evidence/` folder
- Document failures in `docs/V2.4_TEST_RESULTS.md`

---

## Known Issues and Workarounds

### Issue 1: CLI 2 Webhook Not Implemented (BLOCKER)

**Status:** â¸ï¸ Blocking all E2E tests
**Workaround:** None, must wait for CLI 2
**Tracking:** See `docs/V2.2_CLI1_IMPLEMENTATION_SUMMARY.md` Section 8.1

### Issue 2: UserProfileService Not Implemented (BLOCKER)

**Status:** â¸ï¸ Blocking Section 3 (Settings) tests
**Workaround:** CLI 1 logs preferences but doesn't persist
**Tracking:** V2.2 CLI 2 dependency

### Issue 3: Mode Detection Not Populating `game_mode` Field

**Status:** â¸ï¸ May affect Section 2 tests
**Workaround:** Manually inject `game_mode` in test payloads
**Tracking:** Backend `team_tasks.py` lines 131-168

---

## Success Criteria

**Definition of V2.4 Frontend Validation Complete:**

- âœ… **Section 1 (Webhook):** All 3 tests pass (P0)
- âœ… **Section 2 (Mode UI):** All 4 mode tests pass (P0)
- âœ… **Section 3 (Settings):** Core flow works, persistence verified (P1)
- âœ… **Section 4 (Errors):** All failure scenarios handled gracefully (P1)
- âœ… **Section 5 (Cross-Platform):** No critical UX issues on mobile/desktop (P1)
- âœ… **Section 6 (Performance):** All targets met at p95 (P2)
- âœ… **Section 7 (Compliance):** Disclaimer visible in all locations (P2)
- âœ… **Section 8 (Regression):** No V2.0/V2.1 features broken (P2)

**Minimum Release Criteria:**
- All P0 tests pass
- All P1 tests pass or have documented workarounds
- P2 tests can have minor issues if not user-facing

---

## Next Steps After Validation

1. **If all tests pass:**
   - Mark V2.4 as complete
   - Proceed to release preparation (public announcement, demos)

2. **If blockers remain:**
   - Document failures in `docs/V2.4_TEST_RESULTS.md`
   - Create GitHub issues for CLI 2/CLI 3 integration gaps
   - Coordinate with backend team for fixes

3. **Cross-Platform Issues:**
   - Create separate fix tickets for mobile UX issues
   - May defer non-critical mobile fixes to V2.5

---

## Appendix A: Test Evidence Template

For each test, capture:

```markdown
### Test: [Test ID]
**Date:** YYYY-MM-DD
**Tester:** [Name]
**Status:** âœ… Pass | âš ï¸ Partial | âŒ Fail

**Evidence:**
- Screenshot: `docs/v2.4_test_evidence/test_[id]_[description].png`
- Logs: `docs/v2.4_test_evidence/test_[id]_logs.txt`

**Notes:**
[Any observations, edge cases, or deviations from expected behavior]
```

---

## Appendix B: Quick Reference

**Critical File Locations:**
- Frontend Entry: `src/adapters/discord_adapter.py`
- Mode Detection: `src/core/views/paginated_team_view.py:53-79`
- Fallback UI: `src/core/views/fallback_analysis_view.py`
- Settings Modal: `src/core/views/settings_modal.py`
- Contracts: `src/contracts/v2_team_analysis.py`, `src/contracts/discord_interactions.py`

**Feature Flags:**
- `FEATURE_V21_PRESCRIPTIVE_ENABLED` (V2.1 advice buttons)
- `FEATURE_V22_PERSONALIZATION_ENABLED` (V2.2 user profiles)

**Backend Dependencies:**
- CLI 2: Webhook delivery, mode detection, analysis pipeline
- CLI 3: Database persistence for UserProfileService

---

**Document Version:** 1.0
**Last Updated:** 2025-10-07
**Maintained By:** CLI 1 Frontend Team
**Contact:** See `docs/V2.3_CLI1_FRONTEND_GUIDE.md` for architecture details

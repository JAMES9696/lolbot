# V2.4 E2E Testing & Validation Checklist

**Project:** Project Chimera - Discord LOL Analysis Bot
**Phase:** V2.4 CLI 1 Frontend Validation
**Created:** 2025-10-07
**Status:** üü° Ready for Execution (Pending CLI 2 Webhook Delivery Fix)
**Priority:** P0 (Blocks Production Release)

---

## Overview

This checklist serves as the comprehensive validation framework for all V2.0-V2.3 frontend features. It ensures that once CLI 2 completes webhook delivery implementation, all user-facing features work correctly across all supported game modes and scenarios.

**Validation Philosophy:**
- ‚úÖ **Pass**: Feature works as designed, no user-facing issues
- ‚ö†Ô∏è **Partial**: Core functionality works but has minor UX issues
- ‚ùå **Fail**: Critical failure, blocks user experience
- ‚è∏Ô∏è **Blocked**: Cannot test due to backend dependency

---

## Section 1: Webhook Delivery Mechanism Verification (P0)

**Prerequisite:** CLI 2 must implement `publish_team_analysis()` in `src/adapters/discord_webhook.py`

### Test 1.1: Defer Reply Mechanism (3-Second Rule)

**Purpose:** Verify Discord interaction token doesn't expire during analysis

| Test Step | Expected Behavior | Validation Method | Status |
|-----------|-------------------|-------------------|--------|
| 1. User invokes `/jiangli` command | Bot responds with "‚è≥ Ê≠£Âú®ÂàÜÊûê..." within 3 seconds | Check interaction response timestamp | ‚è∏Ô∏è |
| 2. Backend starts analysis (takes 5-30s) | No timeout errors logged | Check Discord API logs | ‚è∏Ô∏è |
| 3. Analysis completes | Webhook PATCH received with result payload | Check webhook logs | ‚è∏Ô∏è |
| 4. Final result displayed | Original message edited with full analysis | Visual inspection | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Defer reply sent < 3 seconds
- ‚úÖ No "Interaction token expired" errors
- ‚úÖ Webhook successfully edits original message

**Code References:**
- `src/adapters/discord_adapter.py:425-445` (defer reply logic)
- `src/adapters/discord_webhook.py` (webhook delivery - CLI 2)

---

### Test 1.2: Webhook Payload Structure Validation

**Purpose:** Ensure webhook payload matches Discord Interaction API spec

| Test Step | Expected Behavior | Validation Method | Status |
|-----------|-------------------|-------------------|--------|
| 1. Capture webhook PATCH request | Contains valid `interaction_token` | Inspect HTTP headers | ‚è∏Ô∏è |
| 2. Validate payload structure | Matches `WebhookDeliveryRequest` contract | Pydantic validation | ‚è∏Ô∏è |
| 3. Check embed data | Valid `discord.Embed` serialization | JSON schema validation | ‚è∏Ô∏è |
| 4. Verify view components | Buttons/pagination correctly serialized | Discord UI component check | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Webhook URL correctly constructed
- ‚úÖ Payload passes Discord API validation
- ‚úÖ Embed and View components render correctly

**Code References:**
- `src/contracts/discord_interactions.py:126-146` (WebhookDeliveryRequest)
- Discord API Docs: https://discord.com/developers/docs/interactions/receiving-and-responding

---

### Test 1.3: Error Handling in Webhook Delivery

**Purpose:** Verify graceful degradation when webhook delivery fails

| Test Step | Expected Behavior | Validation Method | Status |
|-----------|-------------------|-------------------|--------|
| 1. Simulate webhook 404 error | User sees "ÂàÜÊûêÂÆåÊàê‰ΩÜÊäïÈÄíÂ§±Ë¥•" message | Visual inspection | ‚è∏Ô∏è |
| 2. Simulate webhook 429 rate limit | Retry mechanism triggered | Check retry logs | ‚è∏Ô∏è |
| 3. Simulate network timeout | User notified of failure | Error message displayed | ‚è∏Ô∏è |
| 4. Check observability | All failures logged to Sentry | Sentry dashboard | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ User always receives feedback (never left hanging)
- ‚úÖ Retry logic works for transient failures
- ‚úÖ All errors tracked in observability system

**Code References:**
- `src/adapters/discord_webhook.py` (retry logic - CLI 2)
- `src/core/observability.py` (error tracking)

---

## Section 2: Mode-Aware UI Rendering Validation (V2.3 Core)

**Prerequisite:** CLI 2 must populate `game_mode` field in `V2TeamAnalysisReport`

### Test 2.1: Summoner's Rift (5v5) Mode

**Purpose:** Validate full feature set for SR mode

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Mode Emoji** | `game_mode="summoners_rift"` | "üèûÔ∏è Âè¨Âî§Â∏àÂ≥°Ë∞∑" in title | Screenshot title bar | ‚è∏Ô∏è |
| **Vision Control Metric** | Player with high vision score | "Vision Control: 85 (ÈòüÂÜÖ#1)" displayed | Check detailed page | ‚è∏Ô∏è |
| **Pagination** | 5 players on team | 2 pages: Summary + Details | Test prev/next buttons | ‚è∏Ô∏è |
| **V2.1 Prescriptive UI** | Feature flag enabled | "üìã ÂÆûÊìçÂª∫ËÆÆ" button visible | Check button row | ‚è∏Ô∏è |
| **Timeline Evidence** | Feature flag enabled | Timestamped advice (e.g., "15:32") | Expand advice section | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ All SR-specific metrics visible
- ‚úÖ Vision Control shown for all players
- ‚úÖ Pagination works smoothly
- ‚úÖ Prescriptive advice expands correctly

**Test Data Requirements:**
- Match ID from Ranked Solo/Duo queue (Queue ID: 420 or 440)
- At least one player with high vision score (>50)

**Code References:**
- `src/core/views/paginated_team_view.py:53-79` (mode detection)
- `src/core/views/paginated_team_view.py:166-215` (summary page)
- `src/core/views/paginated_team_view.py:217-293` (details page)

---

### Test 2.2: ARAM Mode

**Purpose:** Validate metric filtering for single-lane mode

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Mode Emoji** | `game_mode="aram"` | "‚ùÑÔ∏è ARAMÔºàÊûÅÂú∞Â§ß‰π±ÊñóÔºâ" in title | Screenshot title bar | ‚è∏Ô∏è |
| **Vision Metric Hidden** | Player data with Vision dimension | Vision NOT shown in strength/weakness | Check all 5 player fields | ‚è∏Ô∏è |
| **Alternative Strengths** | Players with non-Vision top dimensions | Show next-best dimension (e.g., Damage) | Verify dimension priority | ‚è∏Ô∏è |
| **KDA Display** | High-kill ARAM game | KDA ratio and kills prominently displayed | Check summary page | ‚è∏Ô∏è |
| **Pagination** | 5 players | 2 pages work correctly | Test navigation | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Vision Control completely hidden from UI
- ‚úÖ Alternative metrics (Damage, Teamfight) prioritized
- ‚úÖ Mode label clearly indicates ARAM

**Test Data Requirements:**
- Match ID from ARAM queue (Queue ID: 450)
- Include player with Vision as top dimension (to test filtering)

**Code References:**
- `src/core/views/paginated_team_view.py:70-79` (`_should_show_vision_control()`)
- `src/core/views/paginated_team_view.py:255-272` (conditional rendering)

---

### Test 2.3: Arena (2v2v2v2) Mode

**Purpose:** Validate UI for Arena mode with correct metrics

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Mode Emoji** | `game_mode="arena"` | "‚öîÔ∏è ArenaÔºàÊñóÈ≠ÇÁ´ûÊäÄÂú∫Ôºâ" in title | Screenshot title bar | ‚è∏Ô∏è |
| **Team Size** | 2-player team (Arena format) | Only 2 players shown in details page | Count player fields | ‚è∏Ô∏è |
| **Vision Metric** | Arena-specific data | Vision shown (Arena has vision control) | Check detailed metrics | ‚è∏Ô∏è |
| **Combat Focus** | Teamfight dimension scores | Teamfight metrics prominently displayed | Check strength/weakness | ‚è∏Ô∏è |
| **Match Duration** | Short matches (8-15 min typical) | Duration correctly displayed | Check summary metadata | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Arena mode correctly identified
- ‚úÖ Only 2 players rendered (not 5)
- ‚úÖ Combat-focused metrics prioritized

**Test Data Requirements:**
- Match ID from Arena queue (Queue ID: 1700, 1710)
- 2v2v2v2 match format

**Code References:**
- `src/core/views/paginated_team_view.py:242-278` (player field rendering)
- Backend: `src/tasks/team_tasks.py:131-168` (mode detection)

---

### Test 2.4: Unknown/Unsupported Mode (Graceful Fallback)

**Purpose:** Validate positive degradation for future/unsupported modes

| Feature | Test Data | Expected Rendering | Visual Check | Status |
|---------|-----------|-------------------|--------------|--------|
| **Fallback Trigger** | `game_mode="unknown"` or unrecognized queue | Fallback embed displayed | Not paginated view | ‚è∏Ô∏è |
| **Fallback Title** | Any unsupported mode | "‚ùì ÊØîËµõÊï∞ÊçÆÊÄªËßà" title | Screenshot title | ‚è∏Ô∏è |
| **Basic Data Display** | Match with KDA data | KDA, gold, damage shown | Check data fields | ‚è∏Ô∏è |
| **Positive Messaging** | - | "üöÄ ÂäüËÉΩÂºÄÂèë‰∏≠" section visible | Check encouragement text | ‚è∏Ô∏è |
| **Supported Modes List** | - | Lists SR, ARAM, Arena with ‚úÖ | Verify list accuracy | ‚è∏Ô∏è |
| **No Error Vibes** | - | No "ÈîôËØØ" or "Â§±Ë¥•" language | Language audit | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ No crash or error state
- ‚úÖ Basic data always displayed
- ‚úÖ Positive, encouraging tone
- ‚úÖ Clear list of supported modes

**Test Data Requirements:**
- Match ID from unsupported queue (e.g., One for All: 1020, URF: 900)
- Or manually set `game_mode="unknown"` in test payload

**Code References:**
- `src/core/views/fallback_analysis_view.py:64-130` (`create_fallback_embed()`)
- `src/core/views/fallback_analysis_view.py:20-50` (FallbackMatchData contract)

---

## Section 3: Settings Functionality Validation (V2.2)

**Prerequisite:** CLI 3 must implement database persistence for UserProfileService

### Test 3.1: Modal Triggering and Input Validation

| Test Step | User Input | Expected Behavior | Validation Method | Status |
|-----------|------------|-------------------|-------------------|--------|
| 1. User invokes `/settings` | - | Modal appears within 3s | Visual timing check | ‚è∏Ô∏è |
| 2. Submit with valid inputs | `main_role="jungle"`, `analysis_tone="competitive"` | Success message: "ËÆæÁΩÆÂ∑≤‰øùÂ≠ò" | Screenshot confirmation | ‚è∏Ô∏è |
| 3. Submit with invalid role | `main_role="toplaner"` (typo) | Error: "‰∏ªË¶Å‰ΩçÁΩÆÂøÖÈ°ªÊòØ..." | Check error message | ‚è∏Ô∏è |
| 4. Submit with invalid tone | `analysis_tone="aggressive"` | Error: "ÂàÜÊûêËØ≠Ê∞îÂøÖÈ°ªÊòØ..." | Check error message | ‚è∏Ô∏è |
| 5. Leave field empty | All fields blank | Error: "ÊâÄÊúâÂ≠óÊÆµÂùá‰∏∫ÂøÖÂ°´È°π" | Check validation logic | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Modal renders correctly with all fields
- ‚úÖ Input validation catches all invalid inputs
- ‚úÖ Clear error messages for each validation failure

**Code References:**
- `src/adapters/discord_adapter.py:638-757` (`_handle_settings_command()`)
- `src/core/views/settings_modal.py:10-95` (UserSettingsModal)

---

### Test 3.2: Database Persistence (Coordinate with CLI 3)

| Test Step | Action | Expected Database State | Validation Method | Status |
|-----------|--------|-------------------------|-------------------|--------|
| 1. First-time user submits settings | Modal submission | New record created in `user_profiles` table | SQL query: `SELECT * FROM user_profiles WHERE discord_user_id='123'` | ‚è∏Ô∏è |
| 2. Existing user updates settings | Change `main_role` from "top" to "mid" | Existing record updated (not duplicated) | Check record count: `COUNT(*) = 1` | ‚è∏Ô∏è |
| 3. Verify field persistence | Submit all 4 fields | All fields correctly stored | Query all columns, verify values | ‚è∏Ô∏è |
| 4. Check timestamp | - | `updated_at` timestamp populated | Verify timestamp format | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ No duplicate user records
- ‚úÖ All preference fields persisted correctly
- ‚úÖ Timestamps automatically managed

**Code References:**
- Backend: CLI 3 `UserProfileService` (not implemented yet)
- Contract: `src/contracts/user_preferences.py:9-42` (UserProfileUpdateRequest)

---

### Test 3.3: Preference Loading and Reflection in Analysis

| Test Step | User Preferences | Expected Analysis Changes | Validation Method | Status |
|-----------|------------------|--------------------------|-------------------|--------|
| 1. User sets `analysis_tone="competitive"` | - | Narrative uses competitive language (e.g., "Rank deficit") | Language audit | ‚è∏Ô∏è |
| 2. User sets `analysis_tone="casual"` | - | Narrative uses casual language (e.g., "Áé©ÁöÑ‰∏çÈîô") | Language audit | ‚è∏Ô∏è |
| 3. User sets `advice_detail_level="concise"` | - | V2.1 advice sections shorter (2-3 bullets max) | Count bullet points | ‚è∏Ô∏è |
| 4. User sets `show_timeline="no"` | - | Timeline evidence hidden (e.g., no "15:32" timestamps) | Visual inspection | ‚è∏Ô∏è |
| 5. User sets `main_role="jungle"` | - | Role-specific advice prioritized for junglers | Content analysis | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Preferences correctly loaded before LLM prompt construction
- ‚úÖ Analysis output reflects user preferences
- ‚úÖ Changes persist across multiple `/jiangli` invocations

**Code References:**
- Backend: `src/tasks/team_tasks.py:199-205` (user profile loading)
- LLM Prompt: Backend must inject preferences into prompt context

---

## Section 4: Error Handling Validation

**Purpose:** Ensure all failure modes have user-friendly messaging

### Test 4.1: Backend Task Failures

| Failure Scenario | Trigger Method | Expected User Message | Visual Check | Status |
|------------------|----------------|----------------------|--------------|--------|
| **Riot API Rate Limit** | Spam 10 commands rapidly | "Riot API ÂΩìÂâçÈôêÊµÅ‰∏≠ÔºåËØ∑Á®çÂêéÈáçËØï" | Screenshot error embed | ‚è∏Ô∏è |
| **Match Not Found** | Invalid Match ID | "Êó†Ê≥ïÊâæÂà∞ËØ•ÊØîËµõÊï∞ÊçÆ" | Check error message | ‚è∏Ô∏è |
| **LLM Analysis Timeout** | Kill LLM service | "ÂàÜÊûêË∂ÖÊó∂ÔºåËØ∑ÈáçËØï" | Check timeout handling | ‚è∏Ô∏è |
| **Database Connection Error** | Kill Postgres | "Êï∞ÊçÆÂ∫ìÊöÇÊó∂‰∏çÂèØÁî®" | Check DB error handling | ‚è∏Ô∏è |
| **Webhook Delivery Failure** | Disable webhook endpoint | "ÂàÜÊûêÂÆåÊàê‰ΩÜÊäïÈÄíÂ§±Ë¥•" | Check fallback message | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ No raw error messages or stack traces shown to users
- ‚úÖ All errors have friendly Chinese explanations
- ‚úÖ Actionable guidance provided (e.g., "please retry")

**Code References:**
- `src/adapters/discord_adapter.py:424-445` (error handling in jiangli command)
- `src/core/views/fallback_analysis_view.py:133-187` (`create_error_fallback_embed()`)

---

### Test 4.2: Interaction Timeout Handling

| Test Step | Scenario | Expected Behavior | Validation Method | Status |
|-----------|----------|-------------------|-------------------|--------|
| 1. User opens V2.1 advice button after 15 min | Interaction expired | Button shows as disabled | Click button, check response | ‚è∏Ô∏è |
| 2. User clicks pagination after timeout | View expired | Buttons grayed out | Visual inspection | ‚è∏Ô∏è |
| 3. Re-invoke command | Fresh analysis | New interactive buttons work | Test new buttons | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ No "interaction failed" errors thrown to user
- ‚úÖ UI clearly indicates expired interactions
- ‚úÖ Re-invocation generates fresh interactive components

**Code References:**
- `src/core/views/paginated_team_view.py:287-291` (`on_timeout()`)
- `src/core/views/prescriptive_view.py:148-152` (collapsible button timeout)

---

## Section 5: Cross-Platform UX Audit

**Purpose:** Ensure consistent experience across all Discord clients

### Test 5.1: Mobile iOS Discord App

| UI Element | Expected Rendering | Test Device | Status |
|------------|-------------------|-------------|--------|
| **Pagination Buttons** | Buttons visible and tappable | iPhone 13+ | ‚è∏Ô∏è |
| **Collapsible Advice** | Expands without horizontal scroll | iPhone SE (small screen) | ‚è∏Ô∏è |
| **Embed Fields** | No text truncation | iPhone 13 Pro | ‚è∏Ô∏è |
| **Modal Input** | Keyboard doesn't cover submit button | iPhone 13 | ‚è∏Ô∏è |
| **Emoji Rendering** | Mode emojis (‚ùÑÔ∏è‚öîÔ∏èüèûÔ∏è) display correctly | iOS 17+ | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ All interactive elements accessible on mobile
- ‚úÖ No text cutoff or layout breaks
- ‚úÖ Modal usable with virtual keyboard

**Testing Notes:**
- Test on both small (SE) and large (Pro Max) screens
- Check portrait and landscape orientations

---

### Test 5.2: Android Discord App

| UI Element | Expected Rendering | Test Device | Status |
|------------|-------------------|-------------|--------|
| **Pagination Buttons** | Buttons visible and tappable | Samsung Galaxy S23 | ‚è∏Ô∏è |
| **Collapsible Advice** | Expands without horizontal scroll | Pixel 6 | ‚è∏Ô∏è |
| **Embed Fields** | No text truncation | OnePlus 11 | ‚è∏Ô∏è |
| **Modal Input** | Keyboard doesn't cover submit button | Samsung S23 | ‚è∏Ô∏è |
| **Emoji Rendering** | Mode emojis display correctly | Android 13+ | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ All interactive elements accessible on mobile
- ‚úÖ Consistent behavior with iOS
- ‚úÖ Modal usable with virtual keyboard

**Testing Notes:**
- Test on different screen sizes (compact, standard, large)
- Check material design button behavior

---

### Test 5.3: Desktop Discord App

| UI Element | Expected Rendering | Test Platform | Status |
|------------|-------------------|---------------|--------|
| **Pagination Buttons** | Buttons styled correctly | Windows 11 | ‚è∏Ô∏è |
| **Collapsible Advice** | Expand animation smooth | macOS Sonoma | ‚è∏Ô∏è |
| **Embed Layout** | Fields aligned properly | Linux (Ubuntu 22.04) | ‚è∏Ô∏è |
| **Modal Center Positioning** | Modal centered on screen | Windows 11 | ‚è∏Ô∏è |
| **Hover States** | Buttons show hover effects | All platforms | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Desktop-specific interactions work (hover, keyboard nav)
- ‚úÖ Layout optimized for larger screens
- ‚úÖ Consistent across Windows/macOS/Linux

**Testing Notes:**
- Check both light and dark Discord themes
- Verify keyboard shortcuts (Tab, Enter, Esc)

---

## Section 6: Performance and Observability

### Test 6.1: Response Time Benchmarks

| Metric | Target | Measurement Method | Status |
|--------|--------|-------------------|--------|
| **Defer Reply Latency** | < 1 second | Timestamp diff: command invoke ‚Üí "‚è≥" message | ‚è∏Ô∏è |
| **Total Analysis Duration** | < 30 seconds (p95) | Timestamp diff: invoke ‚Üí final result | ‚è∏Ô∏è |
| **Webhook Delivery Time** | < 2 seconds | Backend webhook call duration | ‚è∏Ô∏è |
| **Embed Rendering** | < 100ms | Discord client render time (visual lag) | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ All targets met at p95 percentile
- ‚úÖ No user-perceived lag in UI interactions

**Code References:**
- `src/contracts/v2_team_analysis.py:148-150` (`processing_duration_ms` field)
- `src/core/observability.py` (timing metrics)

---

### Test 6.2: Observability Validation

| Observable Event | Expected Log/Metric | Verification Method | Status |
|------------------|-------------------|---------------------|--------|
| **Command Invocation** | `discord.command.jiangli.invoked` | Check Sentry/logs | ‚è∏Ô∏è |
| **Mode Detection** | `analysis.game_mode.{sr\|aram\|arena\|unknown}` | Check telemetry | ‚è∏Ô∏è |
| **Webhook Success** | `discord.webhook.delivery.success` | Check webhook logs | ‚è∏Ô∏è |
| **Webhook Failure** | `discord.webhook.delivery.failed` with error details | Trigger failure, check Sentry | ‚è∏Ô∏è |
| **User Settings Update** | `user.settings.updated` with user_id | Submit modal, check logs | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ All critical events logged
- ‚úÖ Errors automatically sent to Sentry
- ‚úÖ Metrics available in observability dashboard

**Code References:**
- `src/core/observability.py:45-98` (observability utilities)
- `src/adapters/discord_adapter.py:424-445` (logging in command handlers)

---

## Section 7: Legal Compliance Verification

### Test 7.1: Riot Games Disclaimer Display

| Location | Expected Text | Validation Method | Status |
|----------|--------------|-------------------|--------|
| **`/help` Command** | Full disclaimer including "Project Chimera isn't endorsed by Riot Games..." | Screenshot `/help` response | ‚è∏Ô∏è |
| **Public Announcement** | Same disclaimer in all release materials | Review announcement copy | ‚è∏Ô∏è |
| **Bot Profile** | Short disclaimer in bot description | Check Discord bot profile | ‚è∏Ô∏è |

**Pass Criteria:**
- ‚úÖ Disclaimer matches Riot's legal requirements
- ‚úÖ Visible in all public-facing materials
- ‚úÖ No misleading claims about affiliation

**Code References:**
- `src/adapters/discord_adapter.py:817-834` (compliance text in `/help`)

---

## Section 8: Regression Testing

**Purpose:** Ensure V2.3 changes didn't break V2.0/V2.1 features

### Test 8.1: V2.0 Pagination (Baseline)

| Feature | Expected Behavior | Status |
|---------|-------------------|--------|
| **2-Page Layout** | Summary + Details pages | ‚è∏Ô∏è |
| **‚óÄÔ∏è ‰∏ä‰∏ÄÈ°µ Button** | Navigates to previous page | ‚è∏Ô∏è |
| **‚ñ∂Ô∏è ‰∏ã‰∏ÄÈ°µ Button** | Navigates to next page | ‚è∏Ô∏è |
| **Feedback Buttons** | üëçüëé‚≠ê buttons persist across pages | ‚è∏Ô∏è |

**Pass Criteria:** All V2.0 features work identically to pre-V2.3 state

---

### Test 8.2: V2.1 Prescriptive Advice (Baseline)

| Feature | Expected Behavior | Status |
|---------|-------------------|--------|
| **"üìã ÂÆûÊìçÂª∫ËÆÆ" Button** | Visible on details page when flag enabled | ‚è∏Ô∏è |
| **Collapsible Sections** | 3 sections expand independently | ‚è∏Ô∏è |
| **Timeline Evidence** | Timestamps shown when flag enabled | ‚è∏Ô∏è |

**Pass Criteria:** All V2.1 features work identically to pre-V2.3 state

---

## Test Data Preparation Guide

### Required Test Matches

To execute this checklist, prepare the following match IDs:

1. **Summoner's Rift Match**:
   - Queue ID: 420 (Ranked Solo/Duo) or 440 (Ranked Flex)
   - Requirements: 5v5, completed match, high vision player

2. **ARAM Match**:
   - Queue ID: 450
   - Requirements: Single-lane, player with Vision as top dimension

3. **Arena Match**:
   - Queue ID: 1700 or 1710
   - Requirements: 2v2v2v2 format, short duration

4. **Unsupported Mode Match**:
   - Queue ID: 1020 (One for All), 900 (URF), or other
   - Requirements: Valid match data, unsupported by backend

### Test Environment Setup

```bash
# 1. Ensure all feature flags enabled
export FEATURE_V21_PRESCRIPTIVE_ENABLED=true
export FEATURE_V22_PERSONALIZATION_ENABLED=true

# 2. Set observability to debug mode
export LOG_LEVEL=DEBUG

# 3. Start bot in test server
poetry run python main.py

# 4. Create test Discord server with test users
# - User 1: No saved preferences (first-time user)
# - User 2: Existing preferences (settings update test)
```

---

## Execution Instructions

### Phase 1: Pre-Validation (Verify Blockers Resolved)

1. **Confirm CLI 2 Webhook Delivery**:
   ```bash
   # Check if webhook adapter implemented
   rg "publish_team_analysis" src/adapters/discord_webhook.py
   ```
   - Expected: Function implementation exists
   - If missing: Block all tests, escalate to CLI 2

2. **Confirm CLI 3 Database Schema**:
   ```bash
   # Check if user_profiles table exists
   psql -d project_chimera -c "\d user_profiles"
   ```
   - Expected: Table with columns `discord_user_id`, `main_role`, `analysis_tone`, etc.
   - If missing: Block Section 3 tests

### Phase 2: Sequential Test Execution

1. **Section 1: Webhook** (P0) ‚Üí Must pass before proceeding
2. **Section 2: Mode UI** (P0) ‚Üí Can run in parallel with Section 3
3. **Section 3: Settings** (P1) ‚Üí Requires database
4. **Section 4: Errors** (P1) ‚Üí Destructive tests, run last
5. **Section 5: Cross-Platform** (P1) ‚Üí Manual testing, can parallelize
6. **Section 6: Performance** (P2) ‚Üí Run during all above tests
7. **Section 7: Compliance** (P2) ‚Üí Quick verification
8. **Section 8: Regression** (P2) ‚Üí Final smoke test

### Phase 3: Results Documentation

For each test:
- Update "Status" column: ‚úÖ Pass | ‚ö†Ô∏è Partial | ‚ùå Fail | ‚è∏Ô∏è Blocked
- Attach screenshots to `docs/v2.4_test_evidence/` folder
- Document failures in `docs/V2.4_TEST_RESULTS.md`

---

## Known Issues and Workarounds

### Issue 1: CLI 2 Webhook Not Implemented (BLOCKER)

**Status:** ‚è∏Ô∏è Blocking all E2E tests
**Workaround:** None, must wait for CLI 2
**Tracking:** See `docs/V2.2_CLI1_IMPLEMENTATION_SUMMARY.md` Section 8.1

### Issue 2: UserProfileService Not Implemented (BLOCKER)

**Status:** ‚è∏Ô∏è Blocking Section 3 (Settings) tests
**Workaround:** CLI 1 logs preferences but doesn't persist
**Tracking:** V2.2 CLI 2 dependency

### Issue 3: Mode Detection Not Populating `game_mode` Field

**Status:** ‚è∏Ô∏è May affect Section 2 tests
**Workaround:** Manually inject `game_mode` in test payloads
**Tracking:** Backend `team_tasks.py` lines 131-168

---

## Success Criteria

**Definition of V2.4 Frontend Validation Complete:**

- ‚úÖ **Section 1 (Webhook):** All 3 tests pass (P0)
- ‚úÖ **Section 2 (Mode UI):** All 4 mode tests pass (P0)
- ‚úÖ **Section 3 (Settings):** Core flow works, persistence verified (P1)
- ‚úÖ **Section 4 (Errors):** All failure scenarios handled gracefully (P1)
- ‚úÖ **Section 5 (Cross-Platform):** No critical UX issues on mobile/desktop (P1)
- ‚úÖ **Section 6 (Performance):** All targets met at p95 (P2)
- ‚úÖ **Section 7 (Compliance):** Disclaimer visible in all locations (P2)
- ‚úÖ **Section 8 (Regression):** No V2.0/V2.1 features broken (P2)

**Minimum Release Criteria:**
- All P0 tests pass
- All P1 tests pass or have documented workarounds
- P2 tests can have minor issues if not user-facing

---

## Next Steps After Validation

1. **If all tests pass:**
   - Mark V2.4 as complete
   - Proceed to release preparation (public announcement, demos)

2. **If blockers remain:**
   - Document failures in `docs/V2.4_TEST_RESULTS.md`
   - Create GitHub issues for CLI 2/CLI 3 integration gaps
   - Coordinate with backend team for fixes

3. **Cross-Platform Issues:**
   - Create separate fix tickets for mobile UX issues
   - May defer non-critical mobile fixes to V2.5

---

## Appendix A: Test Evidence Template

For each test, capture:

```markdown
### Test: [Test ID]
**Date:** YYYY-MM-DD
**Tester:** [Name]
**Status:** ‚úÖ Pass | ‚ö†Ô∏è Partial | ‚ùå Fail

**Evidence:**
- Screenshot: `docs/v2.4_test_evidence/test_[id]_[description].png`
- Logs: `docs/v2.4_test_evidence/test_[id]_logs.txt`

**Notes:**
[Any observations, edge cases, or deviations from expected behavior]
```

---

## Appendix B: Quick Reference

**Critical File Locations:**
- Frontend Entry: `src/adapters/discord_adapter.py`
- Mode Detection: `src/core/views/paginated_team_view.py:53-79`
- Fallback UI: `src/core/views/fallback_analysis_view.py`
- Settings Modal: `src/core/views/settings_modal.py`
- Contracts: `src/contracts/v2_team_analysis.py`, `src/contracts/discord_interactions.py`

**Feature Flags:**
- `FEATURE_V21_PRESCRIPTIVE_ENABLED` (V2.1 advice buttons)
- `FEATURE_V22_PERSONALIZATION_ENABLED` (V2.2 user profiles)

**Backend Dependencies:**
- CLI 2: Webhook delivery, mode detection, analysis pipeline
- CLI 3: Database persistence for UserProfileService

---

**Document Version:** 1.0
**Last Updated:** 2025-10-07
**Maintained By:** CLI 1 Frontend Team
**Contact:** See `docs/V2.3_CLI1_FRONTEND_GUIDE.md` for architecture details

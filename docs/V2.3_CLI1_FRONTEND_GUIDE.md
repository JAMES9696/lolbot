# V2.3 CLI 1 (Frontend) Development & Maintenance Guide

**Document Version**: 1.0
**Author**: Claude Code
**Date**: 2025-10-07
**Status**: âœ… Production Ready
**Target Audience**: Frontend Developers, DevOps Engineers

---

## Executive Summary

V2.3 CLI 1 (Frontend) implements **Mode-Aware UI** capabilities, enabling the Discord bot to dynamically adapt its interface based on the game mode being analyzed. This enhancement ensures positive user experience across multiple League of Legends game modes: Summoner's Rift, ARAM, Arena, and future modes.

**Key Deliverables**:
- âœ… Mode-aware UI rendering with visual identifiers
- âœ… Conditional metric display (e.g., hide Vision in ARAM)
- âœ… Graceful fallback for unsupported modes
- âœ… `/help` command with compliance information
- âœ… Updated data contracts with `game_mode` field

---

## 1. Architecture Overview

### 1.1 Mode-Aware UI Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLI 2 (Backend)                                                 â”‚
â”‚ - AnalysisStrategyFactory detects queue_id                      â”‚
â”‚ - Assigns game_mode: summoners_rift | aram | arena | unknown   â”‚
â”‚ - Returns V2TeamAnalysisReport with game_mode field             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Webhook/Interaction Response
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLI 1 (Frontend)                                                â”‚
â”‚ - discord_webhook.py receives analysis report                   â”‚
â”‚ - PaginatedTeamAnalysisView reads game_mode                     â”‚
â”‚ - _get_mode_emoji_and_label() returns visual identifier         â”‚
â”‚ - _should_show_vision_control() filters irrelevant metrics      â”‚
â”‚ - Dynamic Embed rendering with mode-specific UI                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Discord API
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User (Discord Client)                                           â”‚
â”‚ - Sees game mode emoji in title (â„ï¸ARAM, âš”ï¸Arena, ğŸï¸SR)       â”‚
â”‚ - Views mode-appropriate metrics (no Vision in ARAM)            â”‚
â”‚ - Receives positive fallback for unknown modes                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Component Architecture

```
src/core/views/
â”œâ”€â”€ paginated_team_view.py       # V2.3: Mode-aware pagination
â”‚   â”œâ”€â”€ _get_mode_emoji_and_label()    # Emoji mapping
â”‚   â”œâ”€â”€ _should_show_vision_control()  # Metric filtering
â”‚   â”œâ”€â”€ _create_summary_page()         # Mode indicator in title
â”‚   â””â”€â”€ _create_team_details_page()    # Conditional rendering
â”‚
â”œâ”€â”€ fallback_analysis_view.py   # V2.3: Unsupported mode UI
â”‚   â”œâ”€â”€ create_fallback_embed()        # Positive degradation
â”‚   â””â”€â”€ create_error_fallback_embed()  # Error recovery
â”‚
â””â”€â”€ settings_modal.py            # V2.2: User preferences (unchanged)

src/contracts/
â””â”€â”€ v2_team_analysis.py          # V2.3: game_mode field added

src/adapters/
â””â”€â”€ discord_adapter.py           # V2.3: /help command added
    â””â”€â”€ _handle_help_command()
```

---

## 2. Implementation Details

### 2.1 Mode Detection & Visual Identifiers

**File**: `src/core/views/paginated_team_view.py:53-68`

```python
def _get_mode_emoji_and_label(self) -> tuple[str, str]:
    """Get emoji and label for game mode.

    V2.3 Enhancement: Mode-aware UI with clear visual identifiers.
    """
    mode_map = {
        "aram": ("â„ï¸", "ARAMï¼ˆæåœ°å¤§ä¹±æ–—ï¼‰"),
        "arena": ("âš”ï¸", "Arenaï¼ˆæ–—é­‚ç«æŠ€åœºï¼‰"),
        "summoners_rift": ("ğŸï¸", "å¬å”¤å¸ˆå³¡è°·"),
        "unknown": ("â“", "æœªçŸ¥æ¨¡å¼"),
    }
    emoji, label = mode_map.get(self.report.game_mode, ("ğŸ®", "æ¸¸æˆæ¨¡å¼"))
    return emoji, label
```

**Purpose**:
- Provides instant visual recognition of game mode
- Used in Embed titles for immediate user context
- Follows Discord best practices for emoji usage

**Supported Modes**:
| Mode | Emoji | Chinese Label | queue_id (examples) |
|------|-------|--------------|---------------------|
| `summoners_rift` | ğŸï¸ | å¬å”¤å¸ˆå³¡è°· | 420 (Ranked Solo), 400 (Draft), 430 (Blind) |
| `aram` | â„ï¸ | æåœ°å¤§ä¹±æ–— | 450 |
| `arena` | âš”ï¸ | æ–—é­‚ç«æŠ€åœº | TBD (Arena queue IDs) |
| `unknown` | â“ | æœªçŸ¥æ¨¡å¼ | Any unrecognized queue_id |

### 2.2 Conditional Metric Display

**File**: `src/core/views/paginated_team_view.py:70-79`

```python
def _should_show_vision_control(self) -> bool:
    """Determine if vision control metric should be displayed.

    V2.3 Enhancement: Mode-specific metric filtering.
    """
    # Vision control is not meaningful in ARAM (single lane, no wards)
    return self.report.game_mode not in ["aram", "unknown"]
```

**Logic**:
- **Summoner's Rift**: Show all metrics (Combat, Economy, Vision, Objective, Teamplay)
- **ARAM**: Hide Vision Control (not applicable on single-lane map)
- **Arena**: TBD based on CLI 4's mode-specific scoring strategy
- **Unknown**: Hide Vision Control as safety default

**Implementation**: `paginated_team_view.py:255-272`

```python
# V2.3: Only show strength if it's not Vision in ARAM mode
show_strength = self._should_show_vision_control() or player.top_strength_dimension != "Vision"
show_weakness = self._should_show_vision_control() or player.top_weakness_dimension != "Vision"

if show_strength:
    field_value += f"âœ¨ ä¼˜åŠ¿: {player.top_strength_dimension} (...)\n"

if show_weakness:
    field_value += f"âš ï¸ åŠ£åŠ¿: {player.top_weakness_dimension} (...)\n"
```

### 2.3 Embed Title Formatting

**Summary Page** (`_create_summary_page:180-188`):
```python
result_emoji = "ğŸ†" if self.report.match_result == "victory" else "ğŸ’”"
mode_emoji, mode_label = self._get_mode_emoji_and_label()

embed = discord.Embed(
    title=f"{result_emoji} {mode_emoji} å›¢é˜Ÿåˆ†ææ€»è§ˆ [ç¬¬ 1/2 é¡µ]",
    description=(
        f"**æ¸¸æˆæ¨¡å¼:** {mode_label}\n"
        f"**Match ID:** `{self.report.match_id}`\n"
        f"**ç›®æ ‡ç©å®¶:** {self.report.target_player_name}"
    ),
    color=0x5865F2 if self.report.match_result == "victory" else 0xE74C3C,
)
```

**Example Titles**:
- Victory, Summoner's Rift: `ğŸ† ğŸï¸ å›¢é˜Ÿåˆ†ææ€»è§ˆ [ç¬¬ 1/2 é¡µ]`
- Defeat, ARAM: `ğŸ’” â„ï¸ å›¢é˜Ÿåˆ†ææ€»è§ˆ [ç¬¬ 1/2 é¡µ]`
- Unknown Mode: `ğŸ† â“ å›¢é˜Ÿåˆ†ææ€»è§ˆ [ç¬¬ 1/2 é¡µ]`

---

## 3. Graceful Fallback Implementation

### 3.1 FallbackAnalysisView

**File**: `src/core/views/fallback_analysis_view.py`

**Purpose**: Provides positive user experience when deep analysis is unavailable.

**Use Cases**:
1. **Unsupported Queue IDs**: New game modes not yet implemented
2. **API Failures**: Riot API returns incomplete data
3. **Backend Degradation**: Analysis pipeline encounters errors

**Key Features**:
- âœ… Displays basic match data (KDA, gold, damage)
- âœ… Positive messaging: "æˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ”¯æŒè¿™ä¸ªæ–°æ¨¡å¼ï¼"
- âœ… Lists currently supported modes
- âœ… No error framing - maintains positive UX

### 3.2 Fallback Data Contract

```python
class FallbackMatchData(BaseModel):
    """Basic match data contract for fallback analysis."""

    # Match metadata
    match_id: str
    game_mode: str
    match_result: str  # "victory" or "defeat"
    match_duration_minutes: int

    # Player identification
    summoner_name: str
    champion_name: str
    champion_level: int

    # Basic performance metrics
    kills: int
    deaths: int
    assists: int
    kda_ratio: float

    # Economy metrics
    gold_earned: int
    total_damage_dealt: int

    # Queue identification (for context)
    queue_id: int | None = None
```

### 3.3 Example Fallback Embed

```python
embed = FallbackAnalysisView.create_fallback_embed(match_data)
```

**Output**:
```
Title: ğŸ† â“ æ¯”èµ›æ•°æ®æ€»è§ˆ
Description:
  æ¸¸æˆæ¨¡å¼: æåœ°å¤§ä¹±æ–—
  å¬å”¤å¸ˆ: TestPlayer
  è‹±é›„: Jinx
  Match ID: NA1_5387390374

Fields:
  ğŸ“Š æˆ˜ç»©æ•°æ®
    KDA: 12 / 5 / 18 (6.00)
    ç»ˆå±€ç­‰çº§: 15
    æ¯”èµ›æ—¶é•¿: 18 åˆ†é’Ÿ

  ğŸ’° ç»æµæ•°æ®
    é‡‘å¸è·å–: 15,430
    æ€»ä¼¤å®³: 28,950

  ğŸš€ åŠŸèƒ½å¼€å‘ä¸­
    æˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ”¯æŒè¿™ä¸ªæ¸¸æˆæ¨¡å¼çš„æ·±åº¦åˆ†æï¼

    ç›®å‰æ”¯æŒçš„æ¨¡å¼ï¼š
    âœ… å¬å”¤å¸ˆå³¡è°·ï¼ˆ5v5ï¼‰
    âœ… æåœ°å¤§ä¹±æ–—ï¼ˆARAMï¼‰
    âœ… æ–—é­‚ç«æŠ€åœºï¼ˆArenaï¼‰

    æ•¬è¯·æœŸå¾…æ›´å¤šæ¨¡å¼çš„æ”¯æŒï¼

Footer: åŸºç¡€æ•°æ®æ¨¡å¼ | Queue ID: 450
```

---

## 4. `/help` Command Implementation

### 4.1 Command Registration

**File**: `src/adapters/discord_adapter.py:216-223`

```python
# V2.3: Register /help command for feature guidance and mode support info
@self.bot.tree.command(
    name="help",
    description="æŸ¥çœ‹æœºå™¨äººåŠŸèƒ½è¯´æ˜å’Œæ”¯æŒçš„æ¸¸æˆæ¨¡å¼",
)
async def help_command(interaction: discord.Interaction) -> None:
    """Handle /help command - V2.3 feature documentation."""
    await self._handle_help_command(interaction)
```

### 4.2 Help Embed Structure

**Handler**: `discord_adapter.py:768-870`

**Sections**:
1. **ğŸ“‹ å¯ç”¨å‘½ä»¤** - List of all slash commands
2. **ğŸ® æ”¯æŒçš„æ¸¸æˆæ¨¡å¼** - V2.3 mode support matrix
3. **ğŸš€ å·²å¯ç”¨åŠŸèƒ½** - Feature flag status (dynamic)
4. **ğŸ¯ å¿«é€Ÿå¼€å§‹** - Step-by-step onboarding
5. **âš–ï¸ åˆè§„ä¸éšç§** - Legal disclaimer and privacy policy

**Example Output**:
```
ğŸ¤– Project Chimera - å¸®åŠ©æ–‡æ¡£

Project Chimera æ˜¯ä¸€ä¸ªè‹±é›„è”ç›Ÿæ¯”èµ›åˆ†ææœºå™¨äººï¼Œä¸ºæ‚¨æä¾› AI é©±åŠ¨çš„ä¸ªæ€§åŒ–è¡¨ç°è¯„ä¼°å’Œæ”¹è¿›å»ºè®®ã€‚

ğŸ“‹ å¯ç”¨å‘½ä»¤
  /bind - ç»‘å®šæ‚¨çš„ Riot è´¦æˆ·
  /unbind - è§£é™¤è´¦æˆ·ç»‘å®š
  /profile - æŸ¥çœ‹å·²ç»‘å®šçš„è´¦æˆ·ä¿¡æ¯
  /analyze [match_index] - ä¸ªäººè¡¨ç°åˆ†æï¼ˆV1ï¼‰
  /team-analyze [match_index] - å›¢é˜Ÿåˆ†æï¼ˆV2ï¼‰
  /settings - é…ç½®ä¸ªæ€§åŒ–åå¥½
  /help - æ˜¾ç¤ºæœ¬å¸®åŠ©ä¿¡æ¯

ğŸ® æ”¯æŒçš„æ¸¸æˆæ¨¡å¼
  âœ… å¬å”¤å¸ˆå³¡è°· - 5v5 æ’ä½/åŒ¹é…
  âœ… æåœ°å¤§ä¹±æ–— (ARAM) - å•çº¿æ··æˆ˜
  âœ… æ–—é­‚ç«æŠ€åœº (Arena) - 2v2v2v2 ç«æŠ€

  æ›´å¤šæ¸¸æˆæ¨¡å¼æ”¯æŒå¼€å‘ä¸­...

ğŸš€ å·²å¯ç”¨åŠŸèƒ½
  âœ… AI æ·±åº¦åˆ†æ
  âœ… å›¢é˜Ÿç›¸å¯¹åˆ†æ
  âœ… ä¸ªæ€§åŒ–åˆ†æ

ğŸ¯ å¿«é€Ÿå¼€å§‹
  1ï¸âƒ£ ä½¿ç”¨ /bind ç»‘å®šæ‚¨çš„ Riot è´¦æˆ·
  2ï¸âƒ£ ä½¿ç”¨ /team-analyze åˆ†ææœ€è¿‘çš„æ¯”èµ›
  3ï¸âƒ£ ä½¿ç”¨ /settings é…ç½®ä¸ªæ€§åŒ–åå¥½
  4ï¸âƒ£ é€šè¿‡åé¦ˆæŒ‰é’®ï¼ˆğŸ‘ğŸ‘â­ï¼‰å¸®åŠ©æˆ‘ä»¬æ”¹è¿›

âš–ï¸ åˆè§„ä¸éšç§
  å…è´£å£°æ˜: Project Chimera æœªè·å¾— Riot Games çš„è®¤å¯æˆ–èµåŠ©ã€‚
  æœ¬æœºå™¨äººä½¿ç”¨ Riot Games APIï¼Œéµå¾ª Riot å¼€å‘è€…æ¡æ¬¾ã€‚

  éšç§: æˆ‘ä»¬ä»…å­˜å‚¨å¿…è¦çš„è´¦æˆ·ç»‘å®šä¿¡æ¯å’ŒåŒ¿ååˆ†ææ•°æ®ã€‚
  æ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨ /unbind è§£é™¤ç»‘å®šå¹¶åˆ é™¤æ•°æ®ã€‚

Footer: Project Chimera 0.1.0 | ç¯å¢ƒ: development
```

### 4.3 Feature Flag Detection

**Dynamic Feature List** (`discord_adapter.py:815-828`):
```python
feature_status = []
if self.settings.feature_ai_analysis_enabled:
    feature_status.append("âœ… AI æ·±åº¦åˆ†æ")
if self.settings.feature_team_analysis_enabled:
    feature_status.append("âœ… å›¢é˜Ÿç›¸å¯¹åˆ†æ")
if self.settings.feature_v21_prescriptive_enabled:
    feature_status.append("âœ… æ—¶é—´è½´è¯æ®åˆ†æ")
if self.settings.feature_v22_personalization_enabled:
    feature_status.append("âœ… ä¸ªæ€§åŒ–åˆ†æ")
if self.settings.feature_voice_enabled:
    feature_status.append("âœ… è¯­éŸ³æ’­æŠ¥")

feature_text = "\n".join(feature_status) if feature_status else "åŸºç¡€åŠŸèƒ½å·²å¯ç”¨"
```

**Purpose**: Provides transparency about which features are currently active.

---

## 5. Data Contract Updates

### 5.1 V2TeamAnalysisReport Enhancement

**File**: `src/contracts/v2_team_analysis.py:130-139`

**New Field**:
```python
game_mode: Literal["summoners_rift", "aram", "arena", "unknown"] = Field(
    default="summoners_rift",
    description=(
        "Game mode identifier for mode-aware UI rendering. "
        "'summoners_rift': 5v5 Ranked/Normal, "
        "'aram': ARAM (Howling Abyss), "
        "'arena': 2v2v2v2 Arena mode, "
        "'unknown': Unsupported/future modes (fallback)"
    ),
)
```

**Backward Compatibility**:
- Default value: `"summoners_rift"` ensures existing code continues to work
- Frontend gracefully handles missing field via default value
- CLI 2 must populate this field based on `AnalysisStrategyFactory` output

### 5.2 Example Updated Report

```json
{
  "match_id": "NA1_5387390374",
  "match_result": "victory",
  "game_mode": "aram",  // <-- NEW V2.3 field
  "target_player_puuid": "...",
  "target_player_name": "TestPlayer",
  "team_analysis": [ /* ... */ ],
  "team_summary_insight": "...",
  "ab_cohort": "B",
  "variant_id": "v2_team_summary_20251006",
  "processing_duration_ms": 2345.67,
  "algorithm_version": "v2"
}
```

---

## 6. Testing Guide

### 6.1 Mode-Aware UI Testing

**Test Cases**:

1. **Summoner's Rift Match**:
   - Create report with `game_mode="summoners_rift"`
   - Verify title shows ğŸï¸ emoji
   - Verify all metrics displayed (Combat, Economy, Vision, Objective, Teamplay)

2. **ARAM Match**:
   - Create report with `game_mode="aram"`
   - Verify title shows â„ï¸ emoji
   - Verify Vision Control metric is hidden or skipped

3. **Arena Match**:
   - Create report with `game_mode="arena"`
   - Verify title shows âš”ï¸ emoji
   - Verify mode-specific metrics displayed

4. **Unknown Mode**:
   - Create report with `game_mode="unknown"`
   - Verify title shows â“ emoji
   - Verify fallback view displays basic data only

### 6.2 Manual Testing Checklist

```bash
# 1. Start bot in development mode
FEATURE_TEAM_ANALYSIS_ENABLED=true python main.py

# 2. Test /help command
# - Verify all sections render correctly
# - Verify feature flags match .env settings
# - Verify compliance text present

# 3. Test mode-aware UI
# - Trigger /team-analyze with SR match â†’ Check ğŸï¸ emoji
# - Trigger /team-analyze with ARAM match â†’ Check â„ï¸ emoji
# - Verify Vision Control hidden in ARAM

# 4. Test fallback view
# - Mock unknown queue_id in backend
# - Verify positive degradation message
# - Verify basic KDA data displayed
```

### 6.3 Automated Testing (Future)

**Recommended Framework**: `tests/ui_components/test_mode_aware_ui.py`

```python
import pytest
from src.core.views.paginated_team_view import PaginatedTeamAnalysisView
from src.contracts.v2_team_analysis import V2TeamAnalysisReport

def test_aram_mode_hides_vision_control():
    """Verify Vision Control metric is hidden in ARAM mode."""
    report = V2TeamAnalysisReport(
        game_mode="aram",
        # ... other fields
    )
    view = PaginatedTeamAnalysisView(report, match_id="TEST")

    # Assert Vision Control not shown
    assert not view._should_show_vision_control()

    # Assert page rendering doesn't include Vision
    embed = view._create_team_details_page()
    # (Further assertions on embed.fields)
```

---

## 7. Deployment Checklist

### 7.1 Pre-Production Validation

- [ ] All V2.3 UI components tested on Discord mobile (iOS/Android)
- [ ] `/help` command displays correct information for production
- [ ] Feature flags configured correctly in production `.env`
- [ ] Compliance disclaimer reviewed by legal team
- [ ] Fallback view tested with various unknown queue IDs

### 7.2 Production Configuration

**Environment Variables** (`.env` for production):
```bash
# V2.3 Mode Support
FEATURE_TEAM_ANALYSIS_ENABLED=true

# Application Info (for /help command)
APP_NAME="Project Chimera"
APP_VERSION="2.3.0"
APP_ENV="production"

# Bot Identity
DISCORD_APPLICATION_ID=<your_app_id>
DISCORD_GUILD_ID=<your_guild_id>  # Optional: guild-specific commands
```

### 7.3 Command Sync

**Important**: After deploying V2.3, sync slash commands to Discord:

```python
# In main.py or deployment script
@bot.event
async def on_ready():
    logger.info(f"Bot ready: {bot.user.name}")

    # Sync commands to Discord
    await bot.tree.sync()  # Global sync (takes up to 1 hour)
    # OR for faster guild-specific sync:
    # guild = discord.Object(id=YOUR_GUILD_ID)
    # await bot.tree.sync(guild=guild)

    logger.info("Commands synced successfully")
```

**Note**: Global command sync can take up to 1 hour to propagate. For testing, use guild-specific sync.

---

## 8. Maintenance Guidelines

### 8.1 Adding New Game Modes

**Steps to Add Support for New Mode** (e.g., "Nexus Blitz"):

1. **Update Mode Enum** (`v2_team_analysis.py`):
   ```python
   game_mode: Literal["summoners_rift", "aram", "arena", "nexus_blitz", "unknown"]
   ```

2. **Add Emoji Mapping** (`paginated_team_view.py:61-67`):
   ```python
   mode_map = {
       # ... existing modes
       "nexus_blitz": ("âš¡", "Nexus Blitz"),
   }
   ```

3. **Define Metric Visibility** (`paginated_team_view.py:70-79`):
   ```python
   def _should_show_vision_control(self) -> bool:
       # Add mode to exclusion list if Vision not applicable
       return self.report.game_mode not in ["aram", "nexus_blitz", "unknown"]
   ```

4. **Update `/help` Command** (`discord_adapter.py:803-807`):
   ```python
   modes_text = (
       "âœ… **å¬å”¤å¸ˆå³¡è°·** - 5v5 æ’ä½/åŒ¹é…\n"
       "âœ… **æåœ°å¤§ä¹±æ–— (ARAM)** - å•çº¿æ··æˆ˜\n"
       "âœ… **æ–—é­‚ç«æŠ€åœº (Arena)** - 2v2v2v2 ç«æŠ€\n"
       "âœ… **Nexus Blitz** - å¿«èŠ‚å¥å›¢é˜Ÿæ¨¡å¼\n\n"
       "æ›´å¤šæ¸¸æˆæ¨¡å¼æ”¯æŒå¼€å‘ä¸­..."
   )
   ```

5. **Coordinate with CLI 2**:
   - Ensure `AnalysisStrategyFactory` maps relevant `queue_id` values to new mode
   - Verify CLI 4 implements mode-specific scoring if needed

### 8.2 Modifying Compliance Text

**Location**: `discord_adapter.py:849-860`

**Process**:
1. Consult legal team for required changes
2. Update `compliance_text` in `_handle_help_command`
3. Test `/help` output in staging environment
4. Deploy and sync commands to production

**Important**: Compliance text is critical for Riot Games API compliance. Changes must be reviewed by legal counsel.

### 8.3 Feature Flag Management

**Adding New Feature Flag**:
1. Add to `settings.py` (e.g., `feature_v23_replay_analysis: bool`)
2. Update `discord_adapter.py` feature status detection
3. Document in `/help` command and this guide

---

## 9. Troubleshooting

### 9.1 Common Issues

**Issue**: Mode emoji not displaying correctly

**Cause**: Discord client caching or unsupported emoji
**Solution**:
- Verify emoji displays correctly in Discord test environment
- Use standard Unicode emojis (avoid custom server emojis)
- Check Discord client version (mobile may render differently)

---

**Issue**: Vision Control still showing in ARAM mode

**Cause**: Backend sending incorrect `game_mode` or frontend logic error
**Solution**:
1. Check backend logs: `grep "game_mode" backend.log`
2. Verify `_should_show_vision_control()` logic
3. Add debug logging in `_create_team_details_page`:
   ```python
   logger.debug(f"Mode: {self.report.game_mode}, Show Vision: {self._should_show_vision_control()}")
   ```

---

**Issue**: `/help` command not showing up

**Cause**: Commands not synced after deployment
**Solution**:
1. Manually sync commands:
   ```python
   await bot.tree.sync()
   ```
2. Wait up to 1 hour for global sync (or use guild-specific sync for faster testing)
3. Verify bot has `applications.commands` scope in OAuth2 URL

---

**Issue**: Fallback view not displaying

**Cause**: Webhook adapter not handling `unknown` game mode
**Solution**:
1. Check `discord_webhook.py` for fallback logic
2. Ensure `FallbackAnalysisView` is imported and used
3. Add try-except in webhook delivery to catch mode handling errors

---

### 9.2 Debug Mode

**Enable Verbose Logging**:
```bash
# In .env
APP_LOG_LEVEL=DEBUG
```

**View Mode-Specific Logs**:
```bash
# Filter logs by mode detection
grep "game_mode" logs/bot.log

# Check UI rendering decisions
grep "should_show_vision" logs/bot.log

# Verify command registration
grep "Command registration" logs/bot.log
```

---

## 10. Performance Considerations

### 10.1 Embed Rendering Efficiency

**Discord Limits**:
- Max 25 fields per embed
- Max 4096 characters per embed
- Max 1024 characters per field value

**Current Usage** (V2.3):
- Summary Page: ~5 fields (well within limit)
- Team Details Page: 5 player fields + footer (10 total, safe)
- Fallback View: 3-4 fields (minimal)

**Optimization**:
- Use `inline=False` sparingly (forces full-width, reduces field count efficiency)
- Truncate long narratives to 150 chars per player
- Cache mode emoji/label lookups (already implemented as pure function)

### 10.2 Memory Footprint

**View Lifecycle**:
- `PaginatedTeamAnalysisView` timeout: 900 seconds (15 minutes)
- After timeout, view is garbage collected
- No long-term state retention

**Recommendation**: No optimization needed for current usage patterns.

---

## 11. Future Enhancements

### 11.1 Planned Features (V2.4+)

1. **Mode-Specific Scoring**:
   - ARAM: Emphasize teamfight efficiency, sustain damage
   - Arena: Highlight augment choices, burst damage
   - Coordinate with CLI 4 for scoring algorithm updates

2. **Localization Support**:
   - Extract all Chinese strings to `src/locales/zh_CN.json`
   - Support English via `/help lang:en`
   - Update mode labels dynamically

3. **Rich Presence Integration**:
   - Use Discord Rich Presence API for bot status
   - Display "Analyzing 3 matches..." in bot profile

4. **Embed Customization**:
   - Allow servers to configure embed colors via `/settings server`
   - Custom mode emojis for premium servers

### 11.2 Mobile Optimization

**Current State**: V2.1 optimizations (page indicators, compact layout) sufficient for most devices.

**Future**: Consider A/B testing "ultra-compact" mode for very small screens (<5 inches).

---

## 12. Appendix

### 12.1 Related Documentation

- `docs/V2_TEAM_ANALYZE_IMPLEMENTATION_CLI1.md` - V2.0 core implementation
- `docs/V2.1_PRESCRIPTIVE_ANALYSIS_CLI1.md` - V2.1 UI enhancements
- `docs/V2.2_CLI1_IMPLEMENTATION_SUMMARY.md` - V2.2 personalization
- `docs/V2.3_CLI1_FRONTEND_GUIDE.md` - This document

### 12.2 Code Reference Index

| Component | File Path | Key Methods |
|-----------|-----------|-------------|
| Mode Detection | `paginated_team_view.py` | `_get_mode_emoji_and_label()` |
| Metric Filtering | `paginated_team_view.py` | `_should_show_vision_control()` |
| Fallback View | `fallback_analysis_view.py` | `create_fallback_embed()` |
| Help Command | `discord_adapter.py` | `_handle_help_command()` |
| Data Contract | `v2_team_analysis.py` | `V2TeamAnalysisReport.game_mode` |

### 12.3 Queue ID Reference

**Common Queue IDs** (for reference):
- 420: Ranked Solo/Duo (SR)
- 440: Ranked Flex (SR)
- 400: Draft Pick (SR)
- 430: Blind Pick (SR)
- 450: ARAM
- TBD: Arena (queue ID varies by season)

**Source**: https://static.developer.riotgames.com/docs/lol/queues.json

### 12.4 Discord API Limits

**Rate Limits**:
- 50 requests per second (global per bot)
- 5 webhook edit requests per second per channel

**Best Practices**:
- Use defer reply for all analysis commands
- Cache static assets (champion icons, etc.)
- Batch webhook edits where possible

---

## 13. Changelog

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-10-07 | Initial V2.3 implementation guide | Claude Code |

---

**Document Status**: âœ… Review Ready
**Last Updated**: 2025-10-07
**Feedback**: Send to all-cli-sync channel for cross-team alignment
